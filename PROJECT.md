# Meta-Lingo

**版本**: v3.8.95

现代化多模态语料库研究软件，基于 Electron + React + TypeScript 前端和 Python FastAPI 后端构建。

## 功能特性

- **语料库管理**: 上传和管理多模态语料 (文本、音频、视频)
  - 多模态文件上传 (拖拽上传，批量处理)
  - 使用 Whisper Large V3 Turbo 进行音频转录 (词级时间戳)
  - 使用 YOLOv8 进行视频对象检测和追踪
  - **使用 CLIP (ViT-Large-Patch14) 进行视频图像语义分类** (2024-12-15/16 更新)
    - 上传时可选启用 CLIP 标注 (默认关闭)
    - 预设标签分类 (Object/Scene/Emotion/Action)
    - 支持自定义标签
    - **可配置帧间隔** (2024-12-16 新增): 上传和重新标注时可设置帧间隔 (默认30帧，设为1则逐帧标注)
    - 逐帧语义分类，结果存储为 JSON
    - 详情页支持重新进行 CLIP 标注 (可选择帧间隔)
  - 视频音频自动提取和转录
  - **异步处理 + 实时进度**: 音视频处理在后台执行，前端通过 SSE 实时显示进度
  - **处理阶段可视化** (2024-12-15 更新): 显示当前处理阶段（提取音频/转录/SpaCy/YOLO/CLIP/保存）
    - 勾选 YOLO/CLIP 时进度条正确显示对应检测阶段
    - 根据处理选项动态调整进度分配
    - 增强日志输出便于调试
  - **SpaCy 自动标注**: 文本上传时自动进行 POS/NER/依存分析
    - **长文本超时优化** (2026-01-06 更新): SpaCy标注请求超时时间从60秒增加到10分钟，支持处理超长文本
    - **全异步处理** (2026-01-06 更新): 所有文本文件上传和重新标注都使用异步后台处理，实时显示进度条
    - **完成任务自动清除** (2026-01-06 更新): 上传任务完成后3秒自动从列表中移除
  - **重新标注功能优化** (2026-01-06 更新, 2026-01-08 音视频支持, 2026-01-28 完整标注流程):
    - **仅处理选中文本**: 重新标注 (SpaCy/USAS/YOLO/CLIP) 现在仅处理用户选中的文本，而非全部文本
    - **顺序处理**: 按照上传时的逻辑，处理完一个文本后再处理下一个，每个文本独立显示进度条
    - **新增 SpaCy 异步重新标注 API**: 后端新增 `/{corpus_id}/texts/{text_id}/reannotate-spacy` 端点
    - **SpaCy 重新标注支持音频/视频** (2026-01-08 新增): SpaCy 重新标注按钮现在支持音频/视频转录文本
    - **音视频完整标注流程** (2026-01-28 新增): 音视频上传和 SpaCy 重新标注现在遵循与文本一致的 SpaCy-USAS-MIPVU 完整流程
    - **编辑保存后自动重新标注** (2026-01-08 新增): 编辑音频/视频转录文本保存后，自动同步触发 SpaCy 和 USAS 重新标注（与纯文本编辑保存一致）
  - **USAS 语义域标注** (2024-12-19 新增/完善, 2026-01-24 三模式支持):
    - PyMUSAS 语义标注引擎 (支持中文和英文)
    - 默认自动对所有文本和转录文本进行语义域标注
    - **异步重新标注** (2026-01-06 更新): USAS重新标注改为异步处理，实时显示进度条
    - **三种标注模式** (2026-01-24 新增):
      - **规则消歧 (rule_based)**: PyMUSAS 规则标注 + 自定义消歧规则，支持 MWE
      - **神经网络 (neural)**: PyMUSAS-Neural-Multilingual-Base-BEM 模型直接预测
      - **混合模式 (hybrid)**: 规则标注 + 神经网络处理未知词，兼具两者优点
    - **处理流程** (rule_based/hybrid):
      1. 标注时获取原始候选标签和 MWE 状态 (不添加后缀)
      2. 预处理: 展开复合标签 (`Df/I2.2` -> `['Df', 'I2.2']`)
      3. 话语域识别: 基于展开后的标签统计21个大类占比
      4. 一文一义: 基于展开后的主标签进行投票
      5. 消歧选择最佳标签
      6. **消歧后**: 对 MWE token 添加 `_MWE` 后缀
    - **MWE 处理**: 先消歧后添加 `_MWE` 后缀 (如 `Z1mf` -> `Z1mf_MWE`)
    - **复合标签拆分**: `N3.8+/A2.1` 拆分为独立记录 `N3.8+` 和 `A2.1`
    - **`+` 后缀保留**: `A3+` 和 `A3` 作为不同语义域
    - 设置页面语义域优先级配置 (类似词频统计词性筛选界面)
    - **设置页面标注模式选择** (2026-01-24 新增)
    - 语料详情页 USAS 重新标注按钮
    - 仅支持中文和英文 (语言选择已过滤其他语言)
  - 转录文本按句分割并逐句 SpaCy 标注 (保留时间戳)
  - 完整元数据管理 (语言/作者/来源/文本类型)
  - 语料库和文本双级标签系统
  - SQLite 数据库存储元数据
  - **卡片/列表双视图切换** (2024-12-17 扁平化美化, 2026-01-15 列表排序)
    - **现代扁平设计**: 纯色背景、简洁边框、适度圆角
    - **统计信息网格**: 淡色背景、淡边框、信息清晰
    - **精致交互效果**: 轻量抬升(4px)、淡阴影、平滑过渡
    - **简约图标**: 淡色图标背景、主题色图标
    - **outlined标签**: 边框样式标签、透明背景
    - 完善双语切换支持
    - **表头排序功能** (2026-01-15): 点击表头可按该列排序（升序/降序），支持文件名、字数、时长、日期、作者、来源、文本类型，默认按文件名升序
  - 文本内容预览 (支持时间戳转录)
  - **语料编辑功能** (2024-12-14 新增, 2024-12-17 更新, 2026-01-08 自动重标注, 2026-01-10 批量编辑):
    - 文本语料直接编辑
    - 音视频转录文本逐句编辑
    - 实体提取 (移除邮箱/网址/电话/IP地址)
    - 文本标准化 (Unicode规范化/空白处理/移除特殊符号/HTML标签/控制字符)
      - **空白处理保留换行** (2024-12-17): 空白字符规范化现在只处理行内空格，保留原文换行结构
      - **独立换行处理选项** (2024-12-17): 新增"合并连续换行"选项，可单独控制是否合并多个连续换行
    - 查找/替换 (支持正则表达式、大小写敏感)
    - **音视频编辑保存后自动重新标注** (2026-01-08 新增): 保存后自动同步触发 SpaCy 和 USAS 重新标注（与纯文本编辑保存一致）
    - **批量编辑** (2026-01-10 新增):
      - 支持选中多个文本文件进行批量编辑
      - 批量查找/替换: 在所有选中文件中执行查找替换
      - 批量实体提取: 从所有选中文件中提取并移除实体
      - 批量文本标准化: 对所有选中文件应用标准化选项
      - 左右键导航: 在编辑界面使用方向键切换查看不同文本的处理状态
      - 保存后自动异步重新标注: 批量保存后自动触发 SpaCy 和 USAS 重新标注

- **文本预处理** (各分析模块独立配置):
  - Unicode 文本规范化
  - 去标点符号 (支持中英文)
  - 转小写
  - 多语言停用词移除 (28 种语言)
  - 中文分词 (jieba)
  - 实体提取 (SpaCy NER)
  - 自定义停用词列表
  - 高级正则清理规则
  - 每个分析模块独立预处理配置

- **分析工具**:
  - **词频统计** (2024-12-16 完善统一, 2024-12-17 词元统计, 2026-01-25 停用词移除):
    - 三栏布局 (左侧控制面板、右上结果表格、右下可视化)
    - **词性筛选**: SpaCy Universal POS 标签多选，保留/过滤双模式
      - **保留模式警告** (2024-12-17): 保留模式下未选择词性时显示警告
    - **搜索目标选择** (2024-12-17 新增): 选择统计词形(word)或词元(lemma)
      - 词形: 按文本中出现的原始形式统计
      - 词元: 使用SpaCy标注的词元(原形)进行统计，如 "running/ran/runs" 统计为 "run"
    - **高级检索**: 最大/最小频率、最小词长、搜索类型 (全部/开头/结尾/包含/正则/词表)
    - **停用词移除** (2026-01-25 新增): 根据语料语言自动加载 NLTK 停用词，支持 20+ 种语言
    - **排除词**: 支持一词一行的排除词列表
    - **全转小写**: 可选转换所有词为小写
    - **结果表格**: 排序、分页、导出 CSV 功能
    - **可视化统一设计**: 灰色参数条 + 圆角可视化图 + 下载控件
      - **D3.js 柱状图**: 水平条形图，支持配色方案和百分比显示
      - **D3.js 饼图**: 环形图/饼图切换，图例交互，居中填充容器
      - **词云图引擎切换** (2026-01-XX 新增):
        - **D3.js 引擎** (默认): 浏览器实时渲染，多种配色方案，最大词数配置，SVG 导出
        - **旧版引擎**: Python wordcloud 库生成，支持蒙版图片、4种样式（默认/使用蒙版/基于图片颜色/带边界映射的图片颜色）、边界映射等高级功能
        - **参数隔离**: 两个引擎的参数独立保存，切换时自动恢复对应配置
        - **蒙版支持**: 旧版引擎支持上传蒙版图片，词云按蒙版形状生成
        - **样式选择**: 旧版引擎支持基于图片颜色的样式和带边界映射的样式
    - 使用 SpaCy 语料库标注数据
  - **同义词分析** (2024-12-18 新增，替代词族统计):
    - 使用 NLTK WordNet + omw-1.4 进行同义词查询
    - 三栏布局 (左侧控制面板、右上结果表格、右下可视化)
    - **词性筛选**: auto/adjective/adverb/noun/verb/pronoun
    - 使用 SpaCy 标注数据提取词汇和词性
    - **WordNet 同义词集**: 显示定义、例句、同义词列表
    - **D3.js 网络图可视化**: 词语-同义词关系网络
    - 结果表格支持展开查看详细同义词集
    - CSV 导出功能
  - **关键词提取** (2024-12-21 重构, 2026-01-28 增强):
    - **两大Tab**: 单文档算法 / 关键性对比
    - **单文档算法**: TF-IDF、TextRank、YAKE!、RAKE
    - **关键性对比** (Keyness): Log-Likelihood、Chi-squared、Log Ratio、Dice等9种统计方法
    - 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
    - **停用词过滤** (2026-01-28 新增): 根据语料库语言移除常见停用词，支持自定义排除词
    - 双语料库选择 (研究语料库 vs 参照语料库)
    - **语料库资源** (2026-01-28 新增): 使用预构建的语料库词频CSV作为参照语料库
      - 支持 BNC、Brown、NOW、OANC 四个语料库资源
      - 资源选择对话框：搜索、标签筛选、卡片预览
      - 自动名称映射（如 bnc_commerce_finance → BNC(Commerce & Finance)）
    - **统计阈值** (2026-01-28 新增): 基于学术标准过滤结果
      - 支持最小分数和最大p值阈值
      - 预设学术标准（如 LL > 6.63 对应 p < 0.01）
    - D3.js 可视化 (柱状图、饼图、词云图)
  - **N-gram 分析** (2024-12-18 完善):
    - 三栏布局 (左侧控制面板、右上结果表格、右下可视化)
    - 支持 2-6 gram 多选分析
    - **Nest N-gram 分组**: 短 N-gram 作为长 N-gram 子集分组显示
    - **词性筛选**: SpaCy Universal POS 标签，保留/过滤双模式
      - N-gram 中每个词都必须满足词性条件
    - **高级检索**: 频率范围、最小词长、搜索类型 (全部/开头/结尾/包含/包含词/正则/词表)
    - **排除词**: 支持一词一行的排除词列表
    - **全转小写**: 可选转换所有词为小写
    - **结果表格**: 排序、分页、Nest 展开显示子 N-gram
    - **D3.js 可视化**:
      - 柱状图: 水平条形图显示 N-gram 频率
      - 网络图: 力导向图显示 N-gram 内词语关系
      - 桑基图: 词语流动图显示词序流转
      - 词云图: N-gram 短语词云
    - 使用 SpaCy 语料库标注数据
  - **共现关系** (2024-12-17 重构, 2024-12-18 搜索模式升级, 2024-12-24 CQL Builder, 2026-01-02 词图联动, 2026-01-27 隐喻高亮):
    - **单页面布局**: 参考主题建模设计，左侧配置面板 + 右侧结果区域
    - **删除旧模式**: 移除词图、常规模式、语法模式三个tab
    - **CQL Builder** (2024-12-24 新增, 2026-01-02 依存关系扩展): 可视化CQL查询构建器
      - 参考Sketch Engine CQL Builder设计
      - 可视化元素卡片: 普通Token、任意Token、距离、OR运算符
      - Token编辑器: 属性(word/lemma/pos/tag/dep/**headword/headlemma/headpos/headdep**)、运算符(=/!=/==/!==)、值输入
      - **头词属性** (2026-01-02): 支持匹配语法头词的词形/词元/词性/依存关系，实现精确语法约束
      - 多条件组合: AND/OR逻辑连接
      - 实时CQL预览和语法验证
      - 模板管理: 内置示例模板(含依存关系示例)、自定义模板保存
      - 一键应用生成的CQL查询
    - **词图分析联动** (2026-01-02 新增): 从词图分析点击搭配词自动生成CQL查询
      - 自动生成包含依存关系约束的CQL查询
      - 搜索主词作为KWIC关键词，上下文高亮搭配词
      - 支持50种语法关系的CQL模板映射
      - 跳转时自动切换到CQL搜索模式
    - **KWIC搜索** (Key Word In Context):
      - **6种搜索模式** (2024-12-18 重构，基于Sketch Engine):
        - **Simple**: 匹配词形或词元，支持通配符 `*`(任意字符)、`?`(单字符)、`|`(或)、`--`(连字符变体)
        - **Lemma**: 基于词元搜索，查找所有词形变化，支持正则表达式
        - **Phrase**: 多词短语精确匹配，支持正则表达式
        - **Word**: 词形精确匹配，支持正则表达式
        - **Character**: 包含特定字符/字符串的token
        - **CQL**: 语料库查询语言，用于复杂搜索
      - **CQL查询引擎** (2026-01-02 增强): 基于Sketch Engine语法，支持word/lemma/pos/tag/dep属性
        - **扩展头词属性**: headword/headlemma/headpos/headdep (匹配语法头词)
        - 逻辑运算: AND(&)、OR(|)、NOT(!)
        - 序列匹配: []任意token、[]{n}重复、[]{min,max}范围、[]?可选
        - 运算符: `=`正则匹配、`==`精确匹配、`!=`正则不匹配、`!==`精确不匹配
        - 正则支持: [word=".*ing"]、[lemma="b.*"]等
        - **依存关系示例**: `[lemma="make"] []{0,5} [dep="dobj" & headlemma="make"]`
      - **词性筛选** (位置调整到搜索配置上方):
        - SpaCy Universal POS 标签多选，保留/过滤双模式
        - 保留模式空选警告: 提示用户至少选择一个词性
        - **全词匹配**: 搜索结果的每个词都必须满足词性筛选条件
        - CQL模式优先级高于词性筛选
      - **A=a**: 搜索时可选忽略大小写
      - **表格工具栏**: 排序、筛选、导出CSV按钮
      - **排序对话框**: 支持1L-3L/KWIC/1R-3R位置选择、Word/Lemma/POS属性、忽略大小写、Retrograde排序
      - **筛选对话框**: 基础/高级模式、包含/不包含、多种查询类型、范围选择
      - **结果展示**: KWIC表格(颜色标记上下文、来源列前置)、行内展开上下文、分页、CSV导出
      - **隐喻高亮** (2026-01-27 新增): 工具栏添加"高亮隐喻"开关，打开后MIPVU标注为隐喻的搜索词所在行显示琥珀色背景
      - **高亮偏移修复** (2026-01-02): 展开上下文换行符规范化，修复Windows/Unix换行符不一致导致的高亮位置偏移
      - **D3.js可视化** (2024-12-17 简化): 密度分布图、分组山脊图 (删除热力图、散点图、覆盖率图、模式图)
  - **语义域分析** (2024-12-19 新增, 2026-01-27 隐喻高亮):
    - 使用USAS标注数据进行语义域分析
    - 三栏布局 (左侧控制面板、右上结果表格、右下可视化)
    - **词性筛选**: SpaCy Universal POS标签，保留/过滤模式
    - **高级检索**: 最大/最小频率、搜索类型 (全部/开头/结尾/包含/正则/词表)
    - **排除词**: 支持一词一行的排除词列表
    - **全转小写**: 可选转换所有词为小写
    - **双视图结果**: 按语义域统计 / 按词语统计
    - **语义域详情**: 点击语义域查看该标签下的所有词汇
    - **D3.js 可视化**: 柱状图 / 饼图
    - 使用USAS语料库标注数据
    - **隐喻词高亮** (2026-01-27 新增):
      - 结果表格工具栏添加"高亮隐喻词"开关 (仅词语模式)
      - 打开开关后，MIPVU 标注为隐喻的词使用绿色加粗显示
      - 语义域详情弹窗中也会高亮隐喻词
      - CSV 导出时，隐喻词会使用 `**word**` 格式标记
      - 后端整合 MIPVU 标注数据，返回 `is_metaphor` 字段
  - **隐喻分析** (2026-01-27 新增, 可视化更新):
    - 基于 MIPVU (Metaphor Identification Procedure VU) 的隐喻识别
    - **仅支持英语**: 使用 DeBERTa 模型进行英语隐喻检测
    - **四步检测流程**:
      1. 词形过滤: 基于 metaphor_filter.json 过滤常见非隐喻词
      2. SpaCy 规则过滤: 根据词性 (CD/NNP/SYM) 和依存关系过滤
      3. HiTZ 模型判断: deberta-large-metaphor-detection-en 主模型预测
      4. 微调模型二次判断: deberta-v3-large-metaphor-in-dt-rb-rp 对 IN/DT/RB/RP 词性二次预测
    - **三栏布局**: 类似词频统计，左侧配置面板、右侧结果/可视化切换
    - **词性筛选**: SpaCy Universal POS 标签，保留/过滤模式
    - **双视图结果**: 按词汇统计 / 按来源统计
    - **统计信息**: 总词数、隐喻词数、非隐喻词数、隐喻率
    - **统一可视化设计** (2026-01-27 更新): 完全复刻词频统计的可视化设计
      - **Tab 栏**: 柱状图 / 饼图 / 词云图
      - **灰色参数条**: 统一样式的配置控件
      - **词云双引擎**: D3.js 引擎 + Python Legacy 引擎
      - **导出功能**: SVG/PNG 导出按钮
      - **仅显示隐喻开关**: 过滤显示隐喻/非隐喻词
      - **空状态设计**: 大图标 + 提示文字
    - **语料库管理集成**: MIPVU 重新标注按钮 (在 USAS 按钮后)
    - **上传自动标注**: 上传英文语料时自动执行 MIPVU 标注 (SpaCy -> USAS -> MIPVU)
    - **编辑保存重新标注**: 编辑语料保存后自动重新标注 MIPVU
  - **Word Sketch 词图分析** (2024-12-21 新增, 2024-12-23 UI优化, 2024-12-26 共现关系联动, 2026-01-02 CQL联动):
    - **两大Tab**: Word Sketch / Word Sketch Difference
    - **Word Sketch**: 词语语法搭配模式分析
      - 50种语法关系模板 (VERB/NOUN/ADJ/ADV/PRON)
      - 基于SpaCy依存句法的关系提取
      - logDice 显著性计算 (搭配强度排序)
      - 词性筛选 (auto/adjective/adverb/noun/verb/pronoun)
      - 三栏布局 (语料库选择/搜索配置/结果卡片)
      - BERTopic风格的关系卡片展示
      - **卡片全部展开** (2024-12-23): 所有关系卡片默认展开，不再限制前5个
      - **展开更多箭头** (2024-12-23): 卡片底部显示更多按钮添加向下箭头图标
      - **卡片独立高度** (2024-12-23): 修复同行卡片高度跟随问题，各卡片高度独立
      - **共现关系联动高亮+过滤** (2024-12-26): 点击搭配词跳转共现关系时，搜索主词并只显示上下文包含搭配词的结果，同时高亮搭配词
      - **CQL精确联动** (2026-01-02 新增): 点击搭配词自动生成CQL查询，包含依存关系约束确保语法关系精确匹配
      - D3.js 柱状图可视化
    - **Word Sketch Difference**: 双词搭配对比
      - 两词搭配行为对比分析
      - **颜色优化** (2024-12-23): word1蓝色、word2红色，颜色梯度从蓝到红 (6/4/2/0/-2/-4/-6)
      - **移除左侧图例** (2024-12-23): 简化界面
      - **卡片独立高度** (2024-12-23): 各卡片高度自适应内容
      - **共现关系联动高亮+过滤** (2024-12-26): 点击搭配词跳转共现关系时，根据搭配词归属选择主词搜索，只显示上下文包含搭配词的结果并高亮
      - **CQL精确联动** (2026-01-02 新增): 对比模式点击搭配词也支持CQL查询生成
      - 共有搭配列表 (双向分数显示，原分数保留)
      - D3.js 网络图可视化 (双词对比，颜色同步更新)
      - 结果表格导出
    - **实时分析**: 基于已有的 SpaCy 标注数据进行实时 Word Sketch 分析
  - **文献可视化** (2024-12-15 新增, 2024-12-25 完善):
    - **文献库管理**: 类似语料库管理，支持创建、删除、查看文献库
    - **Refworks 文件解析**: 支持 WOS (Web of Science) 和 CNKI (中国知网) 两种格式
    - **格式自动识别**: 创建库时指定格式类型，上传时自动校验
    - **文献条目管理**: 每篇文献作为独立条目，支持查看详情、筛选、删除
    - **筛选功能**: 按年份范围、作者、机构、关键词、期刊等条件筛选
    - **D3.js 可视化**:
      - **合作网络**: 作者合作网络、机构合作网络、国家合作网络
      - **共现网络**: 关键词共现网络
      - **共被引网络**: 文献共被引分析
      - **时间线视图**: 按年份展示发文趋势
      - **时区视图**: 按时间段聚类展示
      - **突增检测**: 关键词/作者/期刊突增检测分析
    - **参数配置**: 起止时间、节点类型、最小权重、最大节点数等
  - **主题建模** (2024-12-14 BERTopic, 2024-12-18 LDA, 2024-12-20 LSA/NMF):
    - **四Tab设计**: BERTopic、LDA、LSA 和 NMF 四种主题建模方法
    - **BERTopic**:
      - SBERT 文本嵌入 (paraphrase-multilingual-MiniLM-L12-v2)
      - 利用 SpaCy 标注进行智能预处理
      - 预处理结果预览
      - Embedding 文件管理和复用
      - 降维方法: UMAP, PCA
      - 聚类方法: HDBSCAN, BIRCH, K-Means
      - 向量器: CountVectorizer, TfidfVectorizer
      - 离群值处理
      - Ollama 智能主题命名 (驼峰命名，提示词优化)
      - 自定义主题标签编辑
    - **LDA** (2024-12-18 新增, 2024-12-21 动态分析, 2026-01-10 pyLDAvis, 2026-01-18 主题命名):
      - 双引擎支持: Scikit-learn 和 Gensim
      - 语言相关预处理 (中文jieba分词/英文SpaCy分词)
      - 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
      - 预处理预览功能
      - 完整参数配置 (Alpha/Eta/迭代次数等)
      - 模型评估指标 (困惑度/一致性/对数似然)
      - D3.js 可视化 (主题词条形图/主题分布饼图/文档分布图)
      - **Ollama 主题命名** (2026-01-18 新增): 使用 Ollama LLM 生成驼峰命名的主题名称
      - **自定义标签编辑** (2026-01-18 新增): 手动编辑主题标签，可视化支持使用自定义标签
      - **pyLDAvis 交互可视化** (2026-01-10 新增): 基于 pyLDAvis 库的交互式主题可视化
        - 主题间距离可视化 (PCA/t-SNE/PCoA 降维)
        - 词汇相关性展示 (选中主题显示相关词汇)
        - 智能降维策略 (根据数据规模自动选择最佳方法)
        - 支持 Gensim LDA 模型
      - **LDA 动态主题分析** (2024-12-21 新增, 2026-01-15 日期格式修复):
        - 基于 Gensim LdaSeqModel 的动态主题建模
        - 利用语料元数据日期进行历时研究
        - 日期格式选择 (仅年份/完整日期)
        - **日期格式显示修复** (2026-01-15): 时间演化图X轴日期格式现在正确根据语料元数据的日期和用户设置显示
        - 时间段数量配置 (nr_bins)
        - 演化调整和全局调整选项
        - D3.js 主题时间演化折线图
        - D3.js 主题相似度热力图
        - D3.js 主题演化桑基图 (主题流转可视化)
    - **LSA** (2024-12-20 新增, 2026-01-18 主题命名):
      - 基于 TruncatedSVD 的潜在语义分析
      - TF-IDF 文档-词矩阵构建
      - 语言相关预处理 (中文jieba分词/英文SpaCy分词)
      - 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
      - 预处理预览功能
      - 完整参数配置 (SVD算法/最大特征数/收敛容差等)
      - 模型评估指标 (解释方差比/累积方差/奇异值和)
      - 主题数优化功能 (弹窗形式D3.js解释方差曲线)
      - D3.js 可视化 (主题词条形图/方差图/文档分布图)
      - **Ollama 主题命名** (2026-01-18 新增): 使用 Ollama LLM 生成驼峰命名的主题名称
      - **自定义标签编辑** (2026-01-18 新增): 手动编辑主题标签，可视化支持使用自定义标签
    - **NMF** (2024-12-20 新增, 2026-01-18 主题命名):
      - 基于 sklearn NMF 的非负矩阵分解主题建模
      - TF-IDF 文档-词矩阵构建
      - 语言相关预处理 (中文jieba分词/英文SpaCy分词)
      - 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
      - 预处理预览功能
      - 完整参数配置 (初始化方法/求解器/正则化等)
      - 模型评估指标 (重构误差/稀疏度/迭代次数)
      - 主题数优化功能 (弹窗形式D3.js重构误差曲线)
      - D3.js 可视化 (主题词条形图/主题分布饼图/文档分布图)
      - **Ollama 主题命名** (2026-01-18 新增): 使用 Ollama LLM 生成驼峰命名的主题名称
      - **自定义标签编辑** (2026-01-18 新增): 手动编辑主题标签，可视化支持使用自定义标签
    - **动态主题分析** (2024-12-14 新增, 2026-01-15/16 日期格式修复):
      - 基于语料元数据日期的时间演化分析
      - 日期格式选择 (仅年份/完整日期)
      - **日期格式显示修复** (2026-01-15): 时间演化图X轴日期格式现在正确根据设置显示为仅年份或完整日期(YYYY-MM-DD)
      - **时间戳格式修复** (2026-01-15): 将days-since-epoch整数正确转换为datetime对象传递给BERTopic，修复1970年等错误时间戳显示问题；只有具有有效元数据日期的文档才会参与动态主题分析
      - **完整日期显示修复** (2026-01-16): 使用 `datetime_format='%Y-%m-%d'` 参数确保日期字符串正确解析；在可视化时设置 `tickmode='array'` 和 `tickvals` 强制 Plotly 使用数据中的实际日期作为X轴刻度位置，避免自动选择整年边界(如01-01)的问题
      - 时间段数量配置
      - 演化调整和全局调整选项
      - 主题时间演化可视化 (ECharts 折线图)
    - **Plotly.js 可视化标准实现** (2026-01-XX 重构, 2026-01-10 层次聚类修复):
      - **7种可视化类型**:
        1. **主题信息表**: 表格形式显示主题ID、名称、文档数、关键词
        2. **主题层级关系图**: 使用 BERTopic 的 `visualize_hierarchy()` 生成层次聚类树状图
           - **多层级显示修复** (2026-01-10): 必须先调用 `hierarchical_topics()` 计算层次结构，然后将结果传给 `visualize_hierarchy(hierarchical_topics=...)` 才能显示完整的多层级层次结构（参考官方文档和测试验证）
           - 支持水平/垂直方向切换
           - 支持自定义标签显示
        3. **主体间距离图**: 使用 BERTopic 的 `visualize_topics()` 生成主题间距离散点图
        4. **主题词汇得分图**: 使用 BERTopic 的 `visualize_barchart()` 生成主题词条形图
        5. **主题相似度矩阵图**: 使用 BERTopic 的 `visualize_heatmap()` 生成相似度热图
        6. **文档主题概率分布图**: 使用 BERTopic 的 `visualize_documents()` 生成文档分布散点图
        7. **动态主题演化图**: 使用 BERTopic 的 `visualize_topics_over_time()` 生成时间演化折线图
      - **后端实现**: 使用 BERTopic 内置 Plotly 方法生成图表数据，转换为 JSON 格式返回前端
      - **前端实现**: 使用 `react-plotly.js` 渲染 Plotly 图表，支持主题切换、响应式布局、导出功能
      - **参数配置**: 支持 Top N Topics、词数、自定义标签、采样大小等参数调整
      - **导出功能**: 支持 SVG/PNG 导出（使用 Plotly 内置导出方法）
    - **主题表示模型** (2024-12-15 更新 v2):
      - c-TF-IDF (默认，显示在UI中)
      - KeyBERTInspired (基于 KeyBERT 的关键词提取)
      - MaximalMarginalRelevance (MMR 多样性优化)
      - PartOfSpeech (词性模式，仅支持 lg 模型)
      - Ollama 智能命名移至结果面板"生成主题名称"按钮
    - **主题表格关键词数量** (2024-12-15 新增):
      - 用户可配置显示的关键词数量 (1-20)
    - **可视化自定义标签** (2024-12-15 修复):
      - Ollama 生成的主题名称自动同步到后端缓存
      - 可视化"使用自定义标签"功能正常工作
    - **Embedding 文件管理**:
      - 根据选择的语料库筛选显示对应的 embedding 文件
      - embedding 文件重命名和删除
    - ~~**D3.js 可视化重构** (2024-12-15 v10)~~: 已迁移至 Plotly.js 标准实现
    - **主题合并** (2024-12-15 新增): 选择多个主题进行合并，使用BERTopic的merge_topics方法
    - **自定义标签** (2024-12-15 新增): 手动编辑主题名称，点击编辑图标设置自定义标签
    - **主题详情表格美化** (2024-12-15 更新): 渐变色标题栏、斑马纹行、权重条形图归一化显示
    - **NumberInput 控件统一** (2024-12-15 更新):
      - 所有数值参数使用自定义 +/- 按钮控件
      - 替换原生浏览器 number input 箭头

- **标注模式**:
  - **纯文本标注** (2026-01-06 搜索批量标注):
    - **搜索批量标注功能** (2026-01-06 新增):
      - 工具栏搜索框，输入词语按回车搜索
      - 精确词语匹配 (使用 `\b` 正则边界，如 "some" 不会匹配 "something")
      - 匹配结果高亮显示 (warning.light 颜色)
      - 弹窗确认批量标注，将所有匹配位置标注为当前选中标签
      - 确认后清除高亮并添加标注
    - **分句显示**: 文本按句分割，每句单行显示（横向滚动）
    - **智能句子分割** (2026-01-02 新增/增强, 2026-01-08 原生换行优先): 自定义句子边界检测，正确处理特殊情况
      - **后端句子边界后处理** (2026-01-02 增强): SpaCy 处理后自动校正句子边界，修复 parser 覆盖问题
      - **原生换行优先** (2026-01-08 新增): 优先尊重文本的原生换行符（不含空行）进行分段
        - 单个换行符后有实际内容时，强制在该位置分段
        - 空行（连续换行或仅含空白的行）不作为原生换行
        - 分段优先级：原生换行 > Markdown边界 > 句子结束标点
      - 邮箱地址中的点不作为句子边界 (如 `user@domain.com`)
      - 人名缩写中的点不作为句子边界 (如 `Jeffery P. Benzo`, `J. K. Rowling`)
      - **Markdown 结构分段** (2026-01-02 新增/修复):
        - `#` 标题行作为独立段落
        - `-` `*` `+` 无序列表项作为独立段落（修复逐词分段问题）
        - `1.` `2.` 有序列表项作为独立段落（数字后的点不触发分句）
        - `>` 引用块作为独立段落
        - 空行分隔段落
      - URL 中的点不作为句子边界 (如 `www.example.com`, `https://...`)
      - 小数点不作为句子边界 (如 `3.14`, `100.5`)
      - 常见缩写后的点不作为句子边界 (如 `Dr.`, `Mr.`, `Inc.`, `Ltd.`, 月份缩写等)
      - **前后端逻辑一致**: 后端 SpaCy 和前端 fallback 使用相同的分割逻辑，避免索引错乱
    - **精确标签块**: 标签块在划词正下方，边界与划词边界精确对齐
    - **层叠显示**: 重叠标注时大标签在上（靠近文本），小标签在下
    - **交叉检测**: 禁止交叉标注，只允许完全包含或不重叠
    - **PNG/SVG 导出**: 一键保存完整标注结果为 PNG 或 SVG 图片
    - **标注表格增强**: 显示每条标注的词性(POS)和命名实体(NER)
    - **SpaCy 数据存档** (2026-01-02 新增): 保存存档时自动保存 SpaCy 标注数据，加载存档时自动恢复
    - **文本更新同步** (2026-01-02 修复): 语料库管理中修改文本后，标注模式自动显示最新内容并重新生成 SpaCy 数据
    - **深色模式适配** (2024-12-16 新增): 文本标注容器背景和边框自动适配深色主题
    - **句法结构可视化** (2024-12-18 新增, 2026-01-05 修复):
      - 成分句法 (Constituency): 使用 benepar 模型生成句法树 (D3.js 可视化)
      - 依存句法 (Dependency): 使用 SpaCy displacy 渲染依存关系图
      - 上下箭头控件切换句子 (参考 NumberInput 组件设计)
      - **打包后路径修复** (2026-01-05): 修复 PyInstaller 打包后 benepar 模型路径问题
    - **自动标注功能** (2026-01-28 新增):
      - 在句法结构按钮右侧新增"自动标注"按钮
      - 仅当框架为 MIPVU / Halliday-Theme / Berry-Theme 时可点击，其他框架禁用
      - **MIPVU 自动标注**: 根据语料库管理的 MIPVU 标注数据，自动对文中的隐喻词标注 `indirect` 标签
      - **Theme/Rheme 自动标注**: 利用 SpaCy 标注信息，基于 SFL 理论自动识别并标注 `theme` 和 `rheme`
        - 段落级别标注（整段划词），非逐词标注
        - Theme: 从句首到第一个概念主题（通常是主语）结束
        - Rheme: Theme 之后的所有内容
      - 支持双语界面 (中/英)
  - **多模态标注** (2024-12-16 更新):
    - **视频播放控制**: -5s/+5s 跳转、上一帧/下一帧精确控制
    - **画框模式**: 在视频帧上绘制边界框标注 (使用 videoScale 正确映射坐标)
    - **帧追踪系统**: 帧间隔设置、追踪到上/下一帧、确认框选、保存序列
    - **关键帧插值**: 多关键帧自动线性插值生成中间帧
    - **DAW 范式时间轴**: 三阶段播放针行为 (开始移动 -> 居中滚动 -> 结尾移动)
    - **多轨时间轴**: YOLO追踪轨 / 转录段轨 / 用户标注轨 / 关键帧标记
    - **YOLO 叠加显示**: 实时显示 YOLO 检测框 (使用视频原始坐标)
    - **转录文本标注**: 标签块方式显示，与纯文本标注一致
      - 划词后不高亮原词，在划词下方出现标签方块
      - 方块边界与划词边界精确对齐
      - 重叠标注时大标签在上层（靠近文本）
      - 禁止交叉标注，交叉时显示警告
      - 配色与纯文本标注一致 (浅灰背景)
      - **时间戳下 CLIP 标签** (2024-12-16 新增): 转录句子时间戳下方显示该时间段内的 CLIP 分类标签（紫色）
      - **句法结构可视化** (2024-12-18 新增): 查看转录句子的句法结构 (成分句法/依存句法)
      - **搜索批量标注** (2026-01-06 新增): 搜索词语高亮并批量标注，与纯文本标注一致
    - **转录句子竖条**: 灰色(默认) / 标注色(有标注) / 绿色(选中) 高亮联动
    - **简化UI**: 移除左侧 SpaCy 预标注开关和多余的标注层显示
    - **标注表格增强**: 正确读取并显示 SpaCy 预标注的词性和命名实体
    - **CLIP 展示区** (2024-12-16 新增): 
      - 帧间隔下方新增 CLIP 置信度进度条展示区
      - 显示当前帧各标签的置信度分数 (进度条形式)
      - 随视频播放实时更新，最高置信度标签高亮
      - 媒体选择区显示 CLIP 标签 (紫色)
    - **深色/浅色模式适配** (2024-12-16 新增):
      - 字幕区背景自动适配主题 (浅色模式不再使用黑色背景)
      - CLIP 展示区配色适配深色/浅色主题
  - **标注历史管理** (2024-12-16 更新, 2026-01-02 增强):
    - **全局存档列表** (2026-01-02 优化): 
      - 存档列表显示所有存档，不再依赖语料库/文本选择
      - 点击存档自动切换到对应语料库和文本
      - 存档显示所属语料库名称，便于识别
    - **级联删除** (2026-01-02 新增): 删除文本时自动删除关联的标注存档
    - **语料库/文本重命名安全** (2026-01-02 新增):
      - 存档通过 textId 与文本精确关联，文本重命名不影响关联
      - 语料库重命名时自动同步重命名存档目录和更新存档中的语料库名称
      - 使用 ID 而非名称进行绑定，确保稳定性
    - **文本与存档精确关联**:
      - 存档通过 textId 与文本精确关联，即使文件名改变也不会丢失关联
      - 每篇存档保存当时标注的文本内容快照
      - 语料库中修改文本后，新建标注时显示最新文本内容
    - 存档详情预览（框架、标注数量、时间戳）
    - **CLIP 数据存档支持** (2024-12-16 新增): 多模态存档保存/加载 CLIP 语义分类数据
    - **直接导出**: 点击导出按钮直接下载，以存档名命名
    - **详情页面**: 点击卡片查看完整标注数据
      - 文本标注表格（排序/筛选/搜索/导出CSV）
      - 视频标注表格（YOLO检测 + CLIP分类 + 手动标注）
      - **D3.js 交互式可视化** (2024-12-16 重构, 2024-12-17 太阳图更新):
        - **文本标注可视化**: D3.js 柱状图/饼图，支持导出 PNG/SVG
        - **多模态时间线图**: YOLO/手动标注散点 + CLIP 折线背景（显示各标签置信度变化），双Y轴设计
        - **太阳图**: YOLO/手动标注层级分布，支持点击展开/缩放交互，平滑过渡动画
        - **热图**: YOLO/手动标注时间段分布
        - 支持悬停查看详情，导出 PNG/SVG
    - 搜索和筛选功能
    - 批量导出存档（JSON 格式）
    - 删除存档（带确认）
  - **框架管理** (2024-12 新增):
    - 框架列表展示（按类别分组）
    - 创建新框架
    - 框架树结构预览
    - 复制框架
    - 导入/导出框架
    - 删除框架（带确认）
  - **编码者间信度分析** (2024-12-14 修复, 2026-01-05 重构, 2026-01-06 黄金标准):
    - **数据来源**: 从语料库选取存档 / 上传本地文件
    - **黄金标准/标准答案功能** (2026-01-06 新增):
      - 选择一个存档作为标准答案 (Gold Standard)
      - 额外计算召回率 (Recall) 和精确率 (Precision)
      - 召回率 = 正确标注数 / 标准答案总数
      - 精确率 = 正确标注数 / 编码者标注总数
      - 按标签和编码者分组展示详细结果
    - **支持信度系数** (2026-01-05 重构，参考 ReCal 0.1 Alpha):
      - Average Pairwise Percent Agreement (平均配对百分比一致 + 每对详情)
      - Fleiss' Kappa (多编码者，显示 Observed/Expected Agreement)
      - Average Pairwise Cohen's Kappa (平均配对 Kappa + 每对详情)
      - Krippendorff's Alpha (支持 nominal/ordinal/interval/ratio)
    - **索引-标签矩阵计算** (2026-01-05 新增):
      - 基于字符索引的二值矩阵 (每个字符位置 x 每个标签)
      - 标签覆盖索引记为1，否则为0
      - 支持重叠标注 (同一索引可有多个标签为1)
      - **标签收集策略**: 矩阵包含**所有至少出现一次的标签**（而非框架中的所有标签）
        - 遍历所有编码者的所有标注，收集实际使用的标签
        - 仅统计在标注数据中出现的标签，未使用的框架标签不参与计算
      - 存档格式不变 (JSON)，仅内部转换为矩阵计算
    - **ReCal 样式结果面板** (2026-01-05 新增):
      - 数据概览区 (N coders / N cases / N decisions)
      - 每个系数独立卡片展示
      - 配对详情表格 (Percent Agreement / Cohen's Kappa)
      - Fleiss' Kappa 详情 (Observed/Expected Agreement)
      - Krippendorff's Alpha 详情 (N Decisions / 统计量)
    - **结果可视化**: 系数表格 + 柱状图
    - **报告导出**: HTML/CSV 格式
    - **修复**: 存档加载兼容性 (支持多种字段格式)
    - **KWIC 索引**: 展示所有标注单元及上下文
    - **标注详情比对**: 查看各编码者在特定位置的标注差异
  - **通用功能**:
    - 对接语料库管理，直接加载语料库文本/视频/音频进行标注
    - JSON 格式框架管理 (支持从旧版文件夹格式导入)
    - D3.js 交互式框架树可视化 (点击标签选中)
    - **框架树导出 PNG** (2026-01-02 新增): 一键导出框架树为高清 PNG 图片 (2x 分辨率)
    - 49 个预置标注框架 (SFL、UAM、元话语分析等)

- **应用设置**:
  - 中英文界面切换
  - **自定义壁纸上传** (2026-01-25 新增): 上传自定义壁纸作为应用背景，壁纸占满标签栏以下容器，随窗口等比缩放不变形
  - Ollama 大语言模型集成
  - **USAS 标注模式选择** (2026-01-24 新增): 选择规则消歧/神经网络/混合模式进行语义域标注
  - **软件许可证查看** (2026-01-10 新增): 在应用内查看软件使用许可协议，根据界面语言自动显示中英文版本

- **词典查询** (2024-12-14 新增):
  - **多词典支持**: 同时查询麦克米伦词典、朗文搭配词典等
  - **精美样式**: 各词典专属样式 (麦克米伦红色主题、朗文蓝紫色主题)
  - **深色模式适配** (2024-12-15 新增): 词典内容、面包屑导航、滚动条等全面适配深色主题
  - **模糊搜索**: 精确匹配失败时自动进行前缀/包含匹配
  - **输入建议**: 输入时实时显示匹配词条
  - **词条内链接**: 点击词条内 entry:// 链接跳转查询
  - **面包屑导航**: 查询历史追踪，支持返回之前的查询
  - **懒加载缓存**: 词典按需加载，LRU 缓存优化性能
  - 词典目录: `saves/dict/`

- **主页** (2024-12-17 扁平化美化):
  - 4x3功能卡片网格布局
  - **扁平化设计**: 轻量悬停抬升(4px)、淡阴影、主题色边框高亮
  - **充实卡片**: 最小高度220px、图标容器96x96、图标52px
  - **简约图标容器**: 淡色背景+边框、轻微放大效果(1.05倍)
  - **适度文字**: 标题1.15rem、描述0.9rem
  - **平衡布局**: 顶底留白一致(py: 3)、网格间距3
  - 毛玻璃效果支持(壁纸模式)

- **其他**:
  - 使用手册 (动态加载 Markdown)
    - **双语支持** (2024-12-25 新增): 根据当前界面语言自动加载对应的帮助文档
    - 使用 zh.md 和 en.md 管理中英文帮助文档
    - 一级标题 (h1) 代表模块，作为左侧导航分组
    - 二级标题 (h2) 代表章节，作为子导航项
    - 详细的语料库管理教程

---

## 系统架构

```
+---------------------------------------------------------------+
|                        Meta-Lingo                               |
+---------------------------------------------------------------+
|  +-----------------------------------------------------------+  |
|  |                   前端 (Electron + React)                  |  |
|  |  +-------------+  +-------------+  +-----------------+    |  |
|  |  |   主进程     |  |   渲染进程   |  |    预加载脚本   |    |  |
|  |  | electron/   |  |    src/     |  | electron/      |    |  |
|  |  | main.ts     |  |             |  | preload.ts     |    |  |
|  |  +-------------+  +-------------+  +-----------------+    |  |
|  |                          |                               |  |
|  |  +-------------------------------------------------------+  |
|  |  |              React 应用架构                            |  |
|  |  |  +---------+ +---------+ +---------+ +---------+      |  |
|  |  |  |  页面   | |  组件   | |  状态   | |  API    |      |  |
|  |  |  | pages/  | |components| | stores/ | |  api/   |      |  |
|  |  |  +---------+ +---------+ +---------+ +---------+      |  |
|  |  +-------------------------------------------------------+  |
|  +-----------------------------------------------------------+  |
|                              |                                   |
|                              | HTTP REST API (端口 8000)         |
|                              v                                   |
|  +-----------------------------------------------------------+  |
|  |                   后端 (Python FastAPI)                    |  |
|  |  +-------------+  +-------------+  +-----------------+    |  |
|  |  |   路由      |  |   服务      |  |    数据模型      |    |  |
|  |  | routers/   |  | services/   |  |   models/       |    |  |
|  |  +-------------+  +-------------+  +-----------------+    |  |
|  +-----------------------------------------------------------+  |
|                              |                                   |
|                              v                                   |
|  +-----------------------------------------------------------+  |
|  |                      数据存储                              |  |
|  |  +-----------------+     +-----------------------+        |  |
|  |  |  SQLite 数据库   |     |     文件系统           |        |  |
|  |  |  data/database  |     |  data/corpora/        |        |  |
|  |  |  (元数据+任务)   |     |  (语料文件)            |        |  |
|  |  +-----------------+     +-----------------------+        |  |
|  +-----------------------------------------------------------+  |
|                              |                                   |
|  +-----------------------------------------------------------+  |
|  |                      ML 模型                               |  |
|  |  models/multimodal_analyzer/whisper-large-v3-turbo        |  |
|  |  models/multimodal_analyzer/yolov8                         |  |
|  |  models/multimodal_analyzer/clip-vit-large-patch14        |  |
|  |  models/nltk/ (停用词、分词器)                              |  |
|  +-----------------------------------------------------------+  |
+---------------------------------------------------------------+
```

---

## 目录结构

```
Meta-Lingo-Electron/
|-- electron/                    # Electron 主进程
|   |-- main.ts                  # 主进程入口
|   |-- preload.ts               # 预加载脚本 (IPC 桥接)
|   +-- ipc/                     # IPC 通道定义
|
|-- src/                         # React 前端源码
|   |-- main.tsx                 # React 入口
|   |-- App.tsx                  # 应用根组件
|   |-- api/                     # API 客户端封装
|   |   |-- client.ts            # Axios 实例
|   |   |-- corpus.ts            # 语料库 API (完整 CRUD)
|   |   |-- analysis.ts          # 分析功能 API
|   |   |-- preprocess.ts        # 预处理 API
|   |   |-- utilities.ts         # 工具 API (词典/Ollama/帮助)
|   |   |-- framework.ts         # 框架 API
|   |   |-- annotation.ts        # 标注 API
|   |   +-- sketch.ts            # Word Sketch API (2024-12-21 新增)
|   |-- components/              # 可复用组件
|   |   |-- Layout/              # 布局组件 (AppHeader, TabManager)
|   |   |-- Corpus/              # 语料库组件 (CorpusSelector, PreprocessOptions, TextEditDialog)
|   |   |-- Common/              # 通用组件 (KWICDisplay, LoadingOverlay)
|   |   |-- CorpusResource/      # 语料库资源组件 (2026-01-28 新增)
|   |   |   |-- CorpusResourceCard.tsx    # 资源卡片组件
|   |   |   |-- CorpusResourceDialog.tsx  # 资源选择对话框
|   |   |   +-- index.ts                  # 组件导出
|   |   |-- HelpViewer/          # Markdown 渲染器
|   |   |-- Dictionary/          # 词典组件 (2024-12-14 新增)
|   |   |   |-- DictionaryDialog.tsx      # 词典弹窗主组件
|   |   |   |-- DictionarySelector.tsx    # 词典选择器
|   |   |   |-- DictionaryContent.tsx     # 词条内容渲染
|   |   |   |-- DictionaryBreadcrumb.tsx  # 面包屑导航
|   |   |   +-- DictionaryStyles.ts       # 词典样式
|   |   +-- Annotation/          # 标注组件
|   |       |-- FrameworkTree.tsx      # D3 框架树可视化
|   |       |-- TextAnnotator.tsx      # 划词标注组件
|   |       |-- TranscriptAnnotator.tsx # 转录文本标注 (句子竖条高亮)
|   |       |-- AnnotationLayers.tsx   # 标签堆叠层
|   |       |-- AnnotationTable.tsx    # 标注列表表格
|   |       |-- MultimodalWorkspace.tsx # 多模态工作区 (完整帧追踪系统)
|   |       |-- MultiTrackTimeline.tsx  # 多轨时间轴 (DAW范式播放针)
|   |       +-- AudioWaveform.tsx       # 音频波形显示组件
|   |-- pages/                   # 页面组件
|   |   |-- Home/                # 主页 (功能入口)
|   |   |-- CorpusManagement/    # 语料库管理
|   |   |   |-- index.tsx        # 主容器 (标签页切换)
|   |   |   |-- UploadPanel.tsx  # 多模态上传面板 (同步处理+SpaCy标注)
|   |   |   |-- CorpusList.tsx   # 语料库列表 (卡片/表格视图)
|   |   |   +-- CorpusDetail.tsx # 语料库详情 (文本列表+内容预览)
|   |   |-- WordFrequency/       # 词频统计 (2024-12-16 完善)
|   |   |   |-- index.tsx        # 词频统计主页面 (三栏布局)
|   |   |   |-- POSFilterPanel.tsx    # 词性筛选面板
|   |   |   |-- SearchConfigPanel.tsx # 检索配置面板
|   |   |   |-- ResultsTable.tsx      # 结果表格组件
|   |   |   |-- VisualizationPanel.tsx # 可视化面板
|   |   |   +-- components/
|   |   |       |-- BarChart.tsx      # D3.js 柱状图
|   |   |       |-- PieChart.tsx      # D3.js 饼图
|   |   |       +-- WordCloud.tsx     # ECharts 词云图 (支持蒙版)
|   |   |-- WordFamily/          # 同义词分析 (原词族统计)
|   |   |   |-- index.tsx        # 同义词分析主页面 (三栏布局)
|   |   |   |-- POSFilterPanel.tsx    # 词性筛选面板
|   |   |   |-- SearchConfigPanel.tsx # 搜索配置面板
|   |   |   |-- ResultsTable.tsx      # 结果表格 (可展开同义词集)
|   |   |   |-- VisualizationPanel.tsx # 可视化面板
|   |   |   +-- components/
|   |   |       +-- SynonymNetwork.tsx # D3.js 同义词网络图
|   |   |-- KeywordExtraction/   # 关键词提取 (2024-12-21 重构)
|   |   |   |-- index.tsx        # 主页面 (Tab切换: 单文档/关键性对比)
|   |   |   |-- POSFilterPanel.tsx    # 词性筛选面板
|   |   |   |-- SingleDoc/            # 单文档算法模块
|   |   |   |   |-- index.tsx         # 单文档主入口
|   |   |   |   |-- AlgorithmConfigPanel.tsx  # 算法配置面板
|   |   |   |   |-- ResultsTable.tsx  # 结果表格
|   |   |   |   +-- VisualizationPanel.tsx # 可视化面板
|   |   |   |-- Keyness/              # 关键性对比模块
|   |   |   |   |-- index.tsx         # 关键性对比主入口
|   |   |   |   |-- StatisticsConfigPanel.tsx # 统计方法配置
|   |   |   |   |-- ResultsTable.tsx  # 结果表格
|   |   |   |   +-- VisualizationPanel.tsx # 可视化面板
|   |   |   +-- components/           # 共享组件
|   |   |       |-- BarChart.tsx      # D3.js 柱状图
|   |   |       |-- PieChart.tsx      # D3.js 饼图
|   |   |       +-- WordCloud.tsx     # D3.js 词云图
|   |   |-- NGram/               # N-gram 分析 (2024-12-18 完善)
|   |   |   |-- index.tsx        # N-gram分析主页面 (三栏布局)
|   |   |   |-- POSFilterPanel.tsx    # 词性筛选面板
|   |   |   |-- SearchConfigPanel.tsx # 检索配置面板
|   |   |   |-- ResultsTable.tsx      # 结果表格 (Nest展开)
|   |   |   |-- VisualizationPanel.tsx # 可视化面板
|   |   |   +-- components/
|   |   |       |-- BarChart.tsx      # D3.js 柱状图
|   |   |       |-- NetworkGraph.tsx  # D3.js 网络图
|   |   |       |-- SankeyChart.tsx   # D3.js 桑基图
|   |   |       +-- WordCloud.tsx     # D3.js 词云图
|   |   |-- Collocation/         # 共现关系 (2024-12-17 重构, 2024-12-24 CQL Builder)
|   |   |   |-- index.tsx        # 共现关系主页 (单页面布局，左配置右结果)
|   |   |   +-- components/
|   |   |       |-- CollocationSearchPanel.tsx  # 搜索配置面板
|   |   |       |-- CollocationPOSFilter.tsx    # 词性筛选面板
|   |   |       |-- CQLEditor.tsx              # CQL编辑器 (语法高亮+验证+Builder入口)
|   |   |       |-- CollocationResultsTable.tsx # KWIC结果表格 (行内上下文展开)
|   |   |       |-- CollocationSortDialog.tsx  # 排序对话框
|   |   |       |-- CollocationFilterDialog.tsx # 筛选对话框
|   |   |       |-- CollocationVisualization.tsx # 可视化面板
|   |   |       |-- CQLBuilder/               # CQL可视化构建器 (2024-12-24 新增)
|   |   |       |   |-- index.ts              # 模块导出
|   |   |       |   |-- types.ts              # 类型定义
|   |   |       |   |-- constants.ts          # 常量配置
|   |   |       |   |-- CQLBuilderDialog.tsx  # 构建器弹窗主组件
|   |   |       |   |-- CQLBuilderContent.tsx # 构建内容区域
|   |   |       |   |-- ElementCard.tsx       # 元素卡片组件
|   |   |       |   |-- TokenEditor.tsx       # Token编辑器
|   |   |       |   |-- CQLPreview.tsx        # CQL预览组件
|   |   |       |   +-- SavedTemplates.tsx    # 模板管理组件
|   |   |       +-- d3/
|   |   |           |-- DensityPlot.tsx      # 密度分布图
|   |   |           +-- RidgePlot.tsx        # 分组山脊图 (2024-12-17 新增)
|   |   |-- SemanticAnalysis/    # 语义域分析 (2024-12-19 完善)
|   |   |   |-- index.tsx        # 语义域分析主页面 (三栏布局)
|   |   |   |-- SearchConfigPanel.tsx # 检索配置面板
|   |   |   |-- ResultsTable.tsx      # 结果表格 (双视图)
|   |   |   |-- VisualizationPanel.tsx # 可视化面板
|   |   |   +-- components/
|   |   |       |-- BarChart.tsx      # D3.js 柱状图
|   |   |       +-- PieChart.tsx      # D3.js 饼图
|   |   |-- WordSketch/          # Word Sketch 词图分析 (2024-12-21 新增)
|   |   |   |-- index.tsx        # Word Sketch 主页面 (Tab切换)
|   |   |   |-- WordSketchTab.tsx     # Word Sketch 分析页
|   |   |   |-- WordSketchDiffTab.tsx # Word Sketch Difference 页
|   |   |   +-- components/
|   |   |       |-- SketchVisualization.tsx # D3.js 可视化组件 (Word Sketch)
|   |   |       +-- DiffVisualization.tsx   # D3.js 可视化组件 (Sketch Difference)
|   |   |-- BiblioVisualization/ # 文献可视化 (2024-12-25 完善)
|   |   |   |-- index.tsx        # 主页面 (Tab切换: 上传/库列表/库详情/可视化)
|   |   |   |-- UploadPanel.tsx  # 上传面板 (Refworks文件上传+格式校验)
|   |   |   |-- LibraryList.tsx  # 文献库列表组件
|   |   |   |-- LibraryDetail.tsx # 文献库详情 (条目列表+筛选)
|   |   |   |-- FilterPanel.tsx  # 筛选面板 (年份/作者/机构/关键词)
|   |   |   |-- EntryDetailDialog.tsx # 文献详情弹窗
|   |   |   |-- VisualizationPanel.tsx # 可视化面板 (参数配置+D3.js图表)
|   |   |   +-- components/
|   |   |       +-- d3/          # D3.js 可视化组件
|   |   |           |-- NetworkGraph.tsx  # 合作/共现网络图
|   |   |           |-- TimelineView.tsx  # 时间线视图
|   |   |           |-- TimezoneView.tsx  # 时区视图
|   |   |           +-- BurstChart.tsx    # 突增检测图
|   |   |-- Annotation/          # 标注模式
|   |   |   |-- index.tsx        # 标注入口 (5个标签页)
|   |   |   |-- TextAnnotation.tsx      # 纯文本标注
|   |   |   |-- MultimodalAnnotation.tsx # 多模态标注
|   |   |   |-- AnnotationHistory.tsx   # 标注历史管理 (2024-12 更新)
|   |   |   |-- AnnotationHistoryDetail/ # 标注历史详情 (2024-12 新增)
|   |   |   |   |-- index.tsx           # 详情页面主组件
|   |   |   |   |-- AnnotationDataTable.tsx  # 增强表格 (排序/筛选/导出)
|   |   |   |   |-- VideoAnnotationTable.tsx # 视频标注表格
|   |   |   |   |-- AnnotationVisualization.tsx # 可视化 (柱状图/饼图)
|   |   |   |   +-- MultimodalVisualization.tsx # 多模态可视化 (D3.js 太阳图/时间线/热图)
|   |   |   |-- FrameworkManager.tsx    # 框架管理 (2024-12 新增)
|   |   |   +-- InterCoderReliability/  # 编码者间信度分析 (2024-12 新增)
|   |   |       |-- index.tsx           # 主页面容器
|   |   |       |-- DataSourcePanel.tsx # 数据源选择
|   |   |       |-- CalculationPanel.tsx # 计算配置
|   |   |       |-- ResultsPanel.tsx    # 结果展示
|   |   |       +-- KWICTable.tsx       # KWIC索引表
|   |   |-- TopicModeling/       # 主题建模 (2024-12-14 BERTopic, 2024-12-18 LDA, 2024-12-20 LSA/NMF)
|   |   |   |-- index.tsx        # 主页面 (Tab切换: BERTopic/LDA/LSA/NMF)
|   |   |   |-- PreprocessPanel.tsx   # BERTopic预处理配置面板
|   |   |   |-- EmbeddingPanel.tsx    # Embedding执行面板
|   |   |   |-- AnalysisPanel.tsx     # BERTopic分析配置
|   |   |   |-- ResultsPanel.tsx      # 结果展示面板
|   |   |   |-- VisualizationPanel.tsx # 可视化面板
|   |   |   |-- LDA/                  # LDA模块 (2024-12-18 新增, 2024-12-21 动态分析)
|   |   |   |   |-- index.tsx         # LDA主入口
|   |   |   |   |-- LDAPreprocessPanel.tsx  # 预处理面板 (词性筛选+预览)
|   |   |   |   |-- LDAParameterPanel.tsx   # 参数配置面板
|   |   |   |   |-- LDAResultsPanel.tsx     # 结果展示面板
|   |   |   |   |-- LDAVisualizationPanel.tsx # D3.js可视化面板 (含动态可视化)
|   |   |   |   |-- LDADynamicPanel.tsx     # 动态主题配置面板 (2024-12-21)
|   |   |   |   |-- PerplexityDialog.tsx    # 困惑度优化对话框
|   |   |   |   +-- components/             # LDA可视化组件 (2024-12-21)
|   |   |   |       |-- LDASimilarityHeatmap.tsx   # D3.js相似度热图
|   |   |   |       |-- LDATopicTimeline.tsx      # D3.js时间演化折线图
|   |   |   |       +-- TopicEvolutionSankey.tsx  # D3.js主题演化桑基图
|   |   |   |-- LSA/                  # LSA模块 (2024-12-20 新增)
|   |   |   |   |-- index.tsx         # LSA主入口
|   |   |   |   |-- LSAPreprocessPanel.tsx  # 预处理面板 (词性筛选+预览)
|   |   |   |   |-- LSAParameterPanel.tsx   # 参数配置面板
|   |   |   |   |-- LSAResultsPanel.tsx     # 结果展示面板
|   |   |   |   |-- LSAVisualizationPanel.tsx # D3.js可视化面板
|   |   |   |   +-- VarianceDialog.tsx      # 解释方差优化对话框
|   |   |   |-- NMF/                  # NMF模块 (2024-12-20 新增)
|   |   |   |   |-- index.tsx         # NMF主入口
|   |   |   |   |-- NMFPreprocessPanel.tsx  # 预处理面板 (词性筛选+预览)
|   |   |   |   |-- NMFParameterPanel.tsx   # 参数配置面板
|   |   |   |   |-- NMFResultsPanel.tsx     # 结果展示面板
|   |   |   |   |-- NMFVisualizationPanel.tsx # D3.js可视化面板
|   |   |   |   +-- ReconstructionErrorDialog.tsx # 重构误差优化对话框
|   |   |   +-- components/
|   |   |       +-- visualizations/   # 可视化组件
|   |   |           +-- d3/                  # D3.js 可视化组件 (2024-12-15 重构 v6)
|   |   |               |-- useD3.ts         # D3 hooks 和工具函数
|   |   |               |-- D3Container.tsx  # D3 基础容器组件
|   |   |               |-- TopicBubbleChart.tsx    # 主题气泡图 (已弃用，保留文件)
|   |   |               |-- DocumentScatter.tsx     # 文档散点图
|   |   |               |-- TopicDendrogram.tsx     # 层次聚类图 (已弃用，保留文件)
|   |   |               |-- SimilarityHeatmap.tsx   # 相似性热图
|   |   |               |-- TermDecayChart.tsx      # 词项排名
|   |   |               |-- TopicTimeline.tsx       # 时间演化折线图
|   |   |               |-- TopicWordBars.tsx       # 主题词条形图
|   |   |               +-- index.ts         # 导出
|   |   |-- Settings/            # 应用设置
|   |   +-- Help/                # 使用手册
|   |-- stores/                  # Zustand 状态管理
|   |-- types/                   # TypeScript 类型定义
|   |   |-- corpus.ts            # 语料库完整类型
|   |   |-- annotation.ts        # 标注类型
|   |   +-- ...
|   |-- i18n/                    # 国际化 (中文/英文)
|   +-- styles/                  # MUI 主题配置
|
|-- backend/                     # Python FastAPI 后端
|   |-- main.py                  # FastAPI 入口
|   |-- routers/                 # API 路由
|   |   |-- corpus.py            # 语料库管理 (CRUD + 上传 + 标签)
|   |   |-- analysis.py          # 分析功能
|   |   |-- preprocess.py        # 预处理 API
|   |   |-- help.py              # 帮助文档
|   |   |-- ollama.py            # Ollama 连接
|   |   |-- framework.py         # 框架管理 (CRUD + 导入)
|   |   |-- annotation.py        # 标注保存/加载
|   |   |-- dictionary.py        # 词典查询 (2024-12-14 新增)
|   |   |-- sketch.py            # Word Sketch 词图分析 (2024-12-21 新增)
|   |   |-- biblio.py            # 文献可视化 API (2024-12-25 新增)
|   |   +-- corpus_resource.py   # 语料库资源 API (2026-01-28 新增)
|   |-- services/                # 业务逻辑服务
|   |   |-- preprocess.py        # 统一预处理服务
|   |   |-- whisper_service.py   # Whisper 转录服务
|   |   |-- yolo_service.py      # YOLO 视频标注服务
|   |   |-- clip_service.py      # CLIP 图像语义分类服务 (2024-12-15 新增)
|   |   |-- corpus_service.py    # 语料库业务逻辑 (同步处理)
|   |   |-- spacy_service.py     # SpaCy NLP 服务 (POS/NER/依存)
|   |   |-- framework_importer.py # 框架导入工具
|   |   |-- dictionary_service.py # 词典查询服务 (2024-12-14 新增)
|   |   |-- word_frequency_service.py  # 词频分析服务 (2024-12-16 新增)
|   |   |-- ngram_service.py     # N-gram分析服务 (2024-12-18 新增)
|   |   |-- synonym_service.py   # 同义词分析服务 (2024-12-18 新增)
|   |   |-- keyword_service.py   # 关键词提取服务 (2024-12-21 新增, 2026-01-28 停用词/阈值增强)
|   |   |-- corpus_resource_service.py # 语料库资源服务 (2026-01-28 新增)
|   |   |-- reliability/         # 编码者间信度模块 (2024-12 新增)
|   |   |   |-- __init__.py      # 模块导出
|   |   |   |-- reliability_models.py     # 数据模型
|   |   |   |-- reliability_utils.py      # 辅助函数
|   |   |   |-- reliability_coefficients.py # 信度系数计算
|   |   |   |-- reliability_report.py     # HTML报告生成
|   |   |   +-- reliability_service.py    # 主服务类
|   |   |-- collocation/         # 共现关系模块 (2024-12-16 新增)
|   |   |   |-- __init__.py      # 模块导出
|   |   |   |-- cql_engine.py    # CQL查询引擎 (Sketch Engine语法)
|   |   |   |-- kwic_service.py  # KWIC搜索服务
|   |   |   +-- pos_filter.py    # 词性筛选服务
|   |   |-- topic_modeling/      # 主题建模模块 (2024-12-14 BERTopic, 2024-12-18 LDA, 2024-12-20 LSA/NMF)
|   |   |   |-- __init__.py      # 模块导出
|   |   |   |-- preprocess_service.py     # BERTopic SpaCy标注预处理
|   |   |   |-- embedding_service.py      # SBERT嵌入服务
|   |   |   |-- bertopic_service.py       # BERTopic分析核心
|   |   |   |-- visualization_service.py  # ECharts可视化数据
|   |   |   |-- ollama_naming_service.py  # Ollama主题命名
|   |   |   |-- lda_preprocess_service.py # LDA预处理服务 (2024-12-18)
|   |   |   |-- lda_service.py            # LDA分析服务 (Sklearn/Gensim, 2024-12-21 动态分析)
|   |   |   |-- lsa_service.py            # LSA分析服务 (TruncatedSVD, 2024-12-20)
|   |   |   +-- nmf_service.py            # NMF分析服务 (sklearn NMF, 2024-12-20)
|   |   |-- usas/                # USAS 语义域标注模块 (2024-12-19 新增, 2026-01-24 三模式)
|   |   |   |-- __init__.py      # 模块导出
|   |   |   |-- tagger.py        # PyMUSAS 规则标注核心
|   |   |   |-- neural_tagger.py # PyMUSAS Neural 标注器 (2026-01-24 新增)
|   |   |   |-- disambiguator.py # 消歧逻辑 (话语域识别+一文一义)
|   |   |   +-- domain_config.py # 语义域配置
|   |   |-- mipvu/               # MIPVU 隐喻识别模块 (2026-01-27 新增)
|   |   |   |-- __init__.py      # 模块导出
|   |   |   |-- filter.py        # 词形过滤器 (metaphor_filter.json)
|   |   |   |-- rules.py         # SpaCy 规则过滤 (词性/依存/高置信度规则)
|   |   |   |-- models.py        # 模型加载器 (HiTZ + 微调 DeBERTa)
|   |   |   +-- annotator.py     # 核心标注逻辑 (4步流程)
|   |   |-- sketch_grammar/      # Word Sketch 语法模块 (2024-12-21 新增)
|   |   |   |-- __init__.py      # 模块导出
|   |   |   |-- grammar_patterns.py  # 50种语法关系模板
|   |   |   |-- sketch_engine.py     # Sketch 提取引擎
|   |   |   |-- log_dice.py          # logDice 显著性计算
|   |   |   +-- sketch_service.py    # Sketch 服务 (生成/对比/标注)
|   |   +-- biblio/              # 文献可视化模块 (2024-12-25 新增)
|   |       |-- __init__.py      # 模块导出
|   |       |-- refworks_parser.py   # Refworks 文件解析器 (WOS/CNKI)
|   |       |-- network_builder.py   # 网络构建服务
|   |       |-- cluster_service.py   # 聚类分析服务
|   |       |-- burst_detection.py   # 突增检测服务
|   |       +-- visualization_service.py # 可视化数据服务
|   +-- models/                  # 数据库模型
|       |-- database.py          # SQLite 初始化 + ORM
|       |-- corpus.py            # Pydantic 模型
|       +-- biblio.py            # 文献可视化模型 (2024-12-25 新增)
|
|-- models/                      # ML 模型 (已存在)
|   |-- multimodal_analyzer/
|   |   |-- whisper-large-v3-turbo/   # 音频转录模型
|   |   |-- yolov8/                   # 视频标注模型
|   |   +-- clip-vit-large-patch14/   # CLIP 图像语义分类模型 (2024-12-15 新增)
|   |-- sentence_embeddings/
|   |   +-- paraphrase-multilingual-MiniLM-L12-v2/  # SBERT模型 (主题建模)
|   +-- nltk/                    # NLTK 数据 (停用词等)
|
|-- help/                        # 帮助文档 (Markdown 格式)
|   |-- zh.md                    # 中文使用手册 (2024-12-25 新增)
|   +-- en.md                    # 英文使用手册 (2024-12-25 新增)
|-- data/                        # 数据存储目录
|   |-- database.sqlite          # SQLite 数据库
|   |-- corpora/                 # 语料文件存储
|   |   +-- {corpus_name}/
|   |       |-- files/           # 纯文本文件
|   |       |-- audios/          # 音频及转录
|   |       |-- videos/          # 视频及标注
|   |       |-- preprocessed/    # 预处理结果
|   |       +-- metadata.json
|   |-- frameworks/              # 标注框架 (JSON 格式)
|   +-- annotations/             # 标注存档 (按语料库分组)
|-- saves/                       # 用户数据目录
|   |-- dict/                    # 词典数据 (JSON 格式)
|   |   |-- 麦克米伦.json         # 麦克米伦词典
|   |   +-- 朗文搭配.json         # 朗文搭配词典
|   +-- frameworks/              # 用户框架
|-- assets/                      # 应用图标
|
|-- package.json                 # 前端依赖
|-- requirements.txt             # 后端依赖
|-- vite.config.ts               # Vite 配置
|-- tsconfig.json                # TypeScript 配置
+-- electron-builder.json        # Electron 打包配置
```

---

## 技术栈

### 前端
| 技术 | 版本 | 用途 |
|------|------|------|
| Electron | 28+ | 桌面应用框架 |
| React | 18 | UI 框架 |
| TypeScript | 5 | 类型安全 |
| MUI (Material-UI) | 5 | UI 组件库 |
| Zustand | 4 | 状态管理 |
| i18next | 23 | 国际化 |
| Axios | 1.6 | HTTP 客户端 |
| Vite | 5 | 构建工具 |
| D3.js | 7 | 框架树可视化 + 标注历史可视化 (太阳图/时间线/热图) |
| ECharts | 6 | 交互式图表 (主题建模可视化) |
| echarts-wordcloud | 2.1 | ECharts 词云图扩展 (词频统计可视化) |
| Recharts | 3.5 | 图表组件 |
| html2canvas | 1.4 | PNG 图片导出 |

### 后端
| 技术 | 版本 | 用途 |
|------|------|------|
| Python | 3.12 | 运行环境 |
| FastAPI | 0.109+ | Web 框架 |
| Uvicorn | 0.27+ | ASGI 服务器 |
| SQLite | - | 元数据存储 |
| Transformers | 4.36+ | Whisper/CLIP 模型 |
| Ultralytics | 8.0+ | YOLOv8 模型 |
| CLIP (openai/clip-vit-large-patch14) | - | 图像语义分类 |
| NLTK | 3.8 | NLP 处理 |
| jieba | 0.42+ | 中文分词 |
| SpaCy | 3.8+ | NLP 标注 (POS/NER/依存分析) |
| en_core_web_lg | 3.8 | SpaCy 英文模型 |
| zh_core_web_lg | 3.8 | SpaCy 中文模型 |
| ~~krippendorff~~ | ~~0.6+~~ | ~~Krippendorff's Alpha 计算~~ (已移除：使用手动实现) |
| scikit-learn | 1.4+ | Cohen's Kappa 计算 |
| BERTopic | 0.16+ | 主题建模 (BERTopic) |
| sentence-transformers | 2.2+ | SBERT 文本嵌入 |
| umap-learn | 0.5+ | 降维 (UMAP) |
| hdbscan | 0.8+ | 聚类 (HDBSCAN) |
| gensim | 4.3+ | 主题建模 (LDA) |
| pyLDAvis | 3.4+ | LDA交互可视化 |
| PyMUSAS | 0.3+ | USAS 语义域标注 (规则模式) |
| wsd-torch-models | 0.1+ | USAS 语义域标注 (神经网络模式) |
| en_dual_none_contextual | 0.3.3 | PyMUSAS 英文模型 |
| cmn_dual_upos2usas_contextual | 0.3.3 | PyMUSAS 中文模型 |

---

## 快速启动

### 方式一: 一键启动 (推荐)

双击运行项目根目录下的 `Start Meta-Lingo.app`，或在终端执行：

```bash
cd /Users/tommyleo/Downloads/Meta-Lingo-Electron
./start.sh
```

这将自动:
1. 激活 conda 环境 `meta-lingo-electron`
2. 在新终端窗口启动后端 (端口 8000)
3. 在新终端窗口启动前端 (端口 5173)
4. 自动打开浏览器访问应用

---

## 手动启动方法

### 环境要求
- Node.js 18+
- Python 3.12
- Conda (推荐) 或 venv
- FFmpeg (视频音频提取)

### 方式二: 使用 Conda (推荐)

#### 1. 创建 Conda 环境
```bash
conda create -n meta-lingo-electron python=3.12 -y
conda activate meta-lingo-electron
```

#### 2. 安装后端依赖
```bash
pip install fastapi uvicorn python-multipart httpx pydantic
pip install torch torchaudio transformers  # Whisper
pip install ultralytics opencv-python      # YOLO
pip install jieba nltk spacy               # NLP
```

#### 3. 安装前端依赖
```bash
cd /path/to/Meta-Lingo-Electron
npm install
```

#### 4. 启动后端服务器 (终端1)
```bash
conda activate meta-lingo-electron
cd /path/to/Meta-Lingo-Electron/backend
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

后端启动成功后显示:
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

#### 5. 启动前端开发服务器 (终端2)
```bash
cd /path/to/Meta-Lingo-Electron
npm run dev
```

前端启动成功后显示:
```
VITE v5.x.x  ready in xxx ms
->  Local:   http://localhost:5173/
```

#### 6. 访问应用
打开浏览器访问: **http://localhost:5173**

---

## API 端点

后端 API 运行在 `http://localhost:8000`

### 语料库管理
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/corpus/list` | GET | 获取语料库列表 |
| `/api/corpus/create` | POST | 创建语料库 |
| `/api/corpus/{id}` | GET | 获取语料库详情 |
| `/api/corpus/{id}` | PUT | 更新语料库元数据 |
| `/api/corpus/{id}` | DELETE | 删除语料库 |
| `/api/corpus/{id}/upload` | POST | 上传文件 (支持多模态，异步处理) |
| `/api/corpus/{id}/texts` | GET | 获取语料库文本列表 |
| `/api/corpus/{id}/texts/{text_id}` | GET | 获取文本详情+内容 |
| `/api/corpus/{id}/texts/{text_id}` | PUT | 更新文本元数据 |
| `/api/corpus/{id}/texts/{text_id}` | DELETE | 删除文本 |
| `/api/corpus/{id}/texts/{text_id}/spacy` | GET | 获取 SpaCy 标注 |
| `/api/corpus/{id}/texts/{text_id}/yolo` | GET | 获取 YOLO 追踪标注 |
| `/api/corpus/{id}/texts/{text_id}/media` | GET | 流式传输媒体文件 |
| `/api/corpus/spacy/batch/{id}` | POST | 批量 SpaCy 标注语料库所有文本 |
| `/api/corpus/spacy/single/{id}/{text_id}` | POST | 单个文本 SpaCy 标注 |
| `/api/corpus/{id}/texts/{text_id}/clip` | GET | 获取 CLIP 标注数据 |
| `/api/corpus/clip/single/{id}/{text_id}` | POST | 单个视频 CLIP 标注 (2024-12-15 新增) |
| `/api/corpus/{id}/texts/{text_id}/reannotate-spacy` | POST | 单文本 SpaCy 异步重新标注 (2026-01-06 新增) |
| `/api/corpus/{id}/tags` | POST | 添加语料库标签 |
| `/api/corpus/{id}/texts/{text_id}/tags` | POST | 添加文本标签 |
| `/api/corpus/tasks/{task_id}` | GET | 获取处理任务状态 |
| `/api/corpus/progress/{task_id}` | GET | **SSE 实时进度流** (Server-Sent Events) |
| `/api/corpus/tags/all` | GET | 获取所有标签 |
| `/api/corpus/services/status` | GET | 获取 ML 服务状态 |

#### SSE 进度流说明

上传音视频文件后，后端返回 `task_id`，前端通过 SSE 订阅实时进度：

```javascript
const eventSource = new EventSource('/api/corpus/progress/{task_id}')
eventSource.onmessage = (event) => {
    const data = JSON.parse(event.data)
    // data: { task_id, stage, progress, message, status, result }
    console.log(`${data.stage}: ${data.progress}% - ${data.message}`)
}
```

进度事件格式：
- `stage`: 当前阶段 (initializing/extract_audio/transcribing/spacy/yolo/clip/database/completed)
- `progress`: 进度百分比 (0-100)
- `message`: 状态消息
- `status`: 任务状态 (pending/processing/completed/failed)
- `result`: 完成时的结果数据 (word_count, duration, segments, yolo_tracks, clip_frames)

### 预处理
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/preprocess/text` | POST | 预处理单个文本 |
| `/api/preprocess/preview` | POST | 预览预处理结果 |
| `/api/preprocess/corpus` | POST | 批量预处理语料库 |
| `/api/preprocess/quick` | POST | 快速预处理 |
| `/api/preprocess/languages` | GET | 获取支持的语言列表 |
| `/api/preprocess/stopwords/{lang}` | GET | 获取停用词列表 |

### 分析功能
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/analysis/word-frequency` | POST | 词频分析 (支持词性筛选、高级检索、排除词) |
| `/api/analysis/synonym` | POST | 同义词分析 (NLTK WordNet，支持词性筛选) |
| `/api/analysis/synonym/word/{word}` | GET | 单词同义词查询 |
| `/api/analysis/synonym/pos-options` | GET | 获取词性筛选选项 |
| `/api/analysis/keyword` | POST | 关键词提取 (旧版) |
| `/api/analysis/keyword/single-doc` | POST | 单文档关键词提取 (TF-IDF/TextRank/YAKE/RAKE) |
| `/api/analysis/keyword/keyness` | POST | 关键性对比分析 (9种统计方法) |
| `/api/analysis/keyword/keyness-resource` | POST | 使用语料库资源进行关键性对比 (2026-01-28 新增) |
| `/api/analysis/keyword/thresholds` | GET | 获取默认统计阈值 (2026-01-28 新增) |
| `/api/analysis/keyword/algorithms` | GET | 获取可用算法列表 |
| `/api/analysis/keyword/statistics` | GET | 获取可用统计方法列表 |
| `/api/analysis/ngram` | POST | N-gram 分析 (支持2-6gram多选、Nest分组、词性筛选、高级检索) |
| `/api/analysis/semantic-domains` | POST | 语义域分析 (USAS标注，词性筛选、高级检索、双视图) |
| `/api/analysis/semantic-domains/words` | POST | 获取指定语义域下的所有词汇 |
| `/api/analysis/semantic-domains/categories` | GET | 获取USAS 21大类语义域列表 |
| `/api/analysis/collocation` | POST | 共现关系 |
| `/api/analysis/topic-modeling` | POST | 主题建模 |

### 共现关系 (2024-12-17 重构)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/collocation/search` | POST | KWIC搜索 (7种搜索模式、CQL查询、词性筛选、排序) |
| `/api/collocation/extended-context` | POST | 获取扩展上下文 |
| `/api/collocation/parse-cql` | POST | 解析CQL查询 (语法验证) |
| `/api/collocation/pos-tags` | GET | 获取SpaCy Universal POS标签列表 |
| `/api/collocation/penn-tags` | GET | 获取Penn Treebank词性标签列表 |
| `/api/collocation/dep-tags` | GET | 获取依存关系标签列表 |

### 标注管理
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/framework/list` | GET | 获取框架列表 |
| `/api/framework/{id}` | GET | 获取框架详情 |
| `/api/framework/create` | POST | 创建框架 |
| `/api/framework/delete/{name}` | DELETE | 删除框架 |
| `/api/framework/import-batch` | POST | 批量导入框架 |
| `/api/annotation/list/{corpus}` | GET | 获取标注存档列表 |
| `/api/annotation/load/{corpus}/{id}` | GET | 加载标注存档 |
| `/api/annotation/save` | POST | 保存标注 |
| `/api/annotation/delete/{corpus}/{id}` | DELETE | 删除存档 |

### 编码者间信度分析 (2024-12 新增)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/reliability/validate` | POST | 验证上传的标注文件 |
| `/api/reliability/calculate` | POST | 计算信度系数 |
| `/api/reliability/report` | POST | 生成 HTML/CSV 报告 |
| `/api/reliability/kwic` | POST | 生成 KWIC 索引 |
| `/api/reliability/detail` | POST | 获取特定位置的标注详情 |
| `/api/reliability/archives/{corpus}` | GET | 获取语料库存档列表 |
| `/api/reliability/load-archives` | POST | 加载多个存档内容 |

### 词典查询 (2024-12-14 新增)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/dictionary/list` | GET | 获取可用词典列表 |
| `/api/dictionary/lookup` | GET | 查询单词 (支持多词典、模糊搜索) |
| `/api/dictionary/suggestions` | GET | 获取输入建议 |
| `/api/dictionary/unload/{name}` | POST | 卸载词典释放内存 |
| `/api/dictionary/clear-cache` | POST | 清除所有词典缓存 |

### 主题建模 (2024-12-14 BERTopic, 2024-12-18 LDA, 2024-12-20 LSA/NMF)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/topic-modeling/preprocess/preview` | POST | 预览BERTopic预处理结果 |
| `/api/topic-modeling/embedding` | POST | 执行SBERT Embedding |
| `/api/topic-modeling/embedding/list` | GET | 获取可用Embedding文件列表 |
| `/api/topic-modeling/embedding/{id}` | DELETE | 删除Embedding文件 |
| `/api/topic-modeling/embedding/model-info` | GET | 获取SBERT模型信息 |
| `/api/topic-modeling/analyze` | POST | 执行BERTopic分析 (支持动态主题分析) |
| `/api/topic-modeling/visualization/{result_id}/{type}` | GET | 获取可视化数据 (包括 topics_over_time) |
| `/api/topic-modeling/ollama/check` | GET | 检查Ollama连接状态 |
| `/api/topic-modeling/ollama/naming` | POST | Ollama主题命名 |
| `/api/topic-modeling/results` | GET | 获取缓存的分析结果列表 |
| `/api/topic-modeling/results/{id}` | DELETE | 删除缓存的分析结果 |
| `/api/topic-modeling/merge` | POST | 合并多个主题 (2024-12-15 新增) |
| `/api/topic-modeling/results/{id}/label` | PUT | 更新主题自定义标签 (2024-12-15 新增) |
| `/api/topic-modeling/lda/pos-tags` | GET | 获取LDA词性筛选标签列表 (2024-12-18) |
| `/api/topic-modeling/lda/preprocess/preview` | POST | 预览LDA预处理结果 |
| `/api/topic-modeling/lda/analyze` | POST | 执行LDA分析 (Sklearn/Gensim) |
| `/api/topic-modeling/lda/optimize-topics` | POST | LDA主题数优化 |
| `/api/topic-modeling/lda/results/{id}` | GET | 获取LDA分析结果 |
| `/api/topic-modeling/lda/results/{id}/similarity` | GET | 获取LDA主题相似度矩阵 |
| `/api/topic-modeling/lda/results/{id}/pyldavis` | GET | 获取LDA pyLDAvis交互可视化HTML (2026-01-10) |
| `/api/topic-modeling/lda/analyze-dynamic` | POST | 执行LDA动态主题分析 (2024-12-21) |
| `/api/topic-modeling/lda/results/{id}/topics-over-time` | GET | 获取LDA主题时间演化数据 |
| `/api/topic-modeling/lda/results/{id}/topic-transitions` | GET | 获取LDA主题流转数据 (桑基图) |
| `/api/topic-modeling/lsa/preprocess/preview` | POST | 预览LSA预处理结果 |
| `/api/topic-modeling/lsa/analyze` | POST | 执行LSA分析 (TruncatedSVD) |
| `/api/topic-modeling/lsa/optimize-topics` | POST | LSA主题数优化 |
| `/api/topic-modeling/lsa/results/{id}` | GET | 获取LSA分析结果 |
| `/api/topic-modeling/lsa/results/{id}/similarity` | GET | 获取LSA主题相似度矩阵 |
| `/api/topic-modeling/nmf/preprocess/preview` | POST | 预览NMF预处理结果 |
| `/api/topic-modeling/nmf/analyze` | POST | 执行NMF分析 (sklearn NMF) |
| `/api/topic-modeling/nmf/optimize-topics` | POST | NMF主题数优化 |
| `/api/topic-modeling/nmf/results/{id}` | GET | 获取NMF分析结果 |
| `/api/topic-modeling/nmf/results/{id}/similarity` | GET | 获取NMF主题相似度矩阵 |
| `/api/topic-modeling/lda/results/{id}/label` | PUT | 更新LDA主题自定义标签 (2026-01-18 新增) |
| `/api/topic-modeling/lda/ollama/naming` | POST | LDA主题Ollama命名 (2026-01-18 新增) |
| `/api/topic-modeling/lsa/results/{id}/label` | PUT | 更新LSA主题自定义标签 (2026-01-18 新增) |
| `/api/topic-modeling/lsa/ollama/naming` | POST | LSA主题Ollama命名 (2026-01-18 新增) |
| `/api/topic-modeling/nmf/results/{id}/label` | PUT | 更新NMF主题自定义标签 (2026-01-18 新增) |
| `/api/topic-modeling/nmf/ollama/naming` | POST | NMF主题Ollama命名 (2026-01-18 新增) |

### USAS 语义域标注 (2024-12-19 新增, 2026-01-24 三模式支持)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/usas/domains` | GET | 获取所有语义域列表 (按大类分组) |
| `/api/usas/domain/{code}` | GET | 获取单个语义域详情 |
| `/api/usas/annotate` | POST | 单文本 USAS 标注 (支持 mode_override 参数) |
| `/api/usas/annotate/segments` | POST | 转录段落批量标注 (支持 mode_override 参数) |
| `/api/usas/priority` | GET | 获取优先语义域设置 |
| `/api/usas/priority` | PUT | 更新优先语义域设置 |
| `/api/usas/status` | GET | 获取 USAS 服务状态 |
| `/api/usas/mode` | GET | 获取当前标注模式和各模式可用状态 (2026-01-24 新增) |
| `/api/usas/mode` | PUT | 设置标注模式 (rule_based/neural/hybrid) (2026-01-24 新增) |
| `/api/corpus/{id}/texts/{text_id}/reannotate-usas` | POST | USAS 重新标注 |

### MIPVU 隐喻分析 (2026-01-27 新增)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/analysis/metaphor-analysis` | POST | 隐喻分析 (统计隐喻词频率、来源分布) |
| `/api/analysis/metaphor-analysis/words` | POST | 获取隐喻/非隐喻词列表 |
| `/api/analysis/metaphor-analysis/sources` | GET | 获取隐喻检测来源类型列表 |
| `/api/corpus/{id}/texts/{text_id}/mipvu` | GET | 获取 MIPVU 标注数据 |
| `/api/corpus/{id}/texts/{text_id}/reannotate-mipvu` | POST | MIPVU 重新标注 |

### 语料库资源 (2026-01-28 新增)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/corpus-resource/list` | GET | 获取所有语料库资源列表 |
| `/api/corpus-resource/tags` | GET | 获取所有标签 (中英文) |
| `/api/corpus-resource/{id}` | GET | 获取单个语料库资源详情 |
| `/api/corpus-resource/search` | POST | 搜索语料库资源 (按名称/标签) |
| `/api/corpus-resource/{id}/frequency` | GET | 获取词频数据 (含采样) |
| `/api/corpus-resource/{id}/frequency-table` | GET | 获取完整词频表 |
| `/api/corpus-resource/clear-cache` | POST | 清除频率数据缓存 |

### Word Sketch 词图分析 (2024-12-21 新增)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/sketch/word-sketch` | POST | 生成 Word Sketch (词语搭配分析) |
| `/api/sketch/difference` | POST | Word Sketch Difference (双词搭配对比) |
| `/api/sketch/search` | POST | 搜索搭配词 |
| `/api/sketch/pos-options` | GET | 获取词性筛选选项 |
| `/api/sketch/relations` | GET | 获取所有语法关系类型 |

### 文献可视化 (2024-12-25 新增)
| 端点 | 方法 | 描述 |
|------|------|------|
| `/api/biblio/libraries` | GET | 获取文献库列表 |
| `/api/biblio/libraries` | POST | 创建文献库 |
| `/api/biblio/libraries/{library_id}` | GET | 获取文献库详情 |
| `/api/biblio/libraries/{library_id}` | PUT | 更新文献库 |
| `/api/biblio/libraries/{library_id}` | DELETE | 删除文献库 |
| `/api/biblio/libraries/{library_id}/upload` | POST | 上传 Refworks 文件 (自动解析) |
| `/api/biblio/libraries/{library_id}/entries` | GET | 获取文献条目列表 (支持筛选) |
| `/api/biblio/entries/{entry_id}` | GET | 获取单个条目详情 |
| `/api/biblio/entries/{entry_id}` | DELETE | 删除单个条目 |
| `/api/biblio/visualize/network` | POST | 生成网络可视化数据 |
| `/api/biblio/visualize/timeline` | POST | 生成时间线可视化数据 |
| `/api/biblio/visualize/burst` | POST | 生成突增检测数据 |

API 文档: http://localhost:8000/docs

---

## 打包发布

### 前置条件

打包前请确保已安装以下依赖：

1. **Node.js 和 npm**
   ```bash
   node -v  # 检查 Node.js 版本
   npm -v   # 检查 npm 版本
   ```

2. **Python 和 conda**
   ```bash
   python --version  # 检查 Python 版本
   conda --version   # 检查 conda 版本
   ```

3. **conda 环境 `meta-lingo-electron`**
   ```bash
   conda env list  # 查看环境列表，确认 meta-lingo-electron 存在
   ```

### 一键打包（推荐）

使用一键打包脚本，自动完成 Python 后端打包和 Electron 前端打包。**脚本会自动激活 conda 环境，无需手动激活。**

#### macOS 打包

1. **进入项目目录**
```bash
cd /path/to/Meta-Lingo-Electron
   ```

2. **添加执行权限（首次使用）**
   ```bash
   chmod +x build.sh
   ```

3. **运行打包脚本**
   ```bash
./build.sh
```

#### Windows 打包

1. **打开命令提示符（CMD）或 PowerShell**

2. **进入项目目录**
```cmd
cd C:\path\to\Meta-Lingo-Electron
   ```

3. **运行打包脚本**
   ```cmd
build.bat
```

### 打包流程说明

脚本会自动执行以下步骤：

1. **检查依赖**
   - 检查 Node.js、npm、conda、Python
   - 检查/安装 PyInstaller

2. **检查并同步版本号**
   - 自动检查 README.md 和启动页的版本号是否一致
   - 如果不一致，自动更新启动页版本号为 README 的版本号
   - 确保版本号同步后再进行打包

3. **清理旧构建文件**
   - 删除 `dist/`、`dist-electron/`、`release/`、`backend-dist/` 等

4. **清理测试数据（出厂状态）**
   - 自动清理语料库、标注存档、主题建模数据、Word2Vec 模型、数据库文件
   - 重置 USAS 设置为默认值
   - 重置标注框架为默认框架
   - **⚠️ 注意：此步骤会删除所有测试数据，请提前备份！**

5. **打包 Python 后端**
   - 使用 PyInstaller 打包后端为独立可执行文件
   - 输出到 `backend-dist/meta-lingo-backend/`

6. **安装前端依赖**
   - 如果 `node_modules` 不存在，自动运行 `npm install`

7. **构建前端和 Electron**
   - 运行 `npm run build:frontend`
   - 生成 `dist/` 和 `dist-electron/`

8. **打包 Electron 应用**
   - macOS: 生成 `.dmg` 安装包（自动检测架构：arm64 或 x64）
   - Windows: 生成 `.exe` 安装程序（支持用户自定义安装路径）

### 打包输出

打包完成后，安装包位于 `release/` 目录：

```
release/
├── Meta-Lingo-{version}-Setup.exe  (Windows)
└── Meta-Lingo-{version}-{arch}.dmg  (macOS)
```

### 常见问题

**Q: 脚本报错找不到 conda 环境？**  
A: 确保 `meta-lingo-electron` 环境已创建：
```bash
conda env list  # 检查环境是否存在
# 如果不存在，需要先创建环境
```

**Q: conda 自动激活失败？**  
A: 可以手动激活后再运行脚本：
```bash
conda activate meta-lingo-electron
./build.sh  # macOS
# 或
build.bat   # Windows
```

**Q: 打包时间很长？**  
A: 正常现象。首次打包可能需要 10-30 分钟，取决于：
- 机器性能
- 网络速度（下载 Electron 和依赖）
- 磁盘 I/O 速度

**Q: 打包失败怎么办？**  
A: 检查错误信息，常见原因：
- conda 环境未正确配置
- Node.js 版本不兼容
- 磁盘空间不足（需要至少 15GB 可用空间）
- 网络连接问题（无法下载依赖）

**Q: 如何只打包特定平台？**  
A: macOS 脚本自动检测架构，Windows 脚本默认打包 x64。如需修改，可编辑脚本中的 `electron-builder` 命令。

### 手动打包

如果需要单独执行某个步骤：

```bash
# 1. 激活 conda 环境
conda activate meta-lingo-electron

# 2. 打包 Python 后端
cd backend
pyinstaller --clean --noconfirm backend.spec
cd ..
mv backend/dist backend-dist

# 3. 构建前端
npm run build:frontend

# 4. 打包 Electron 应用
npx electron-builder --mac --config electron-builder.json  # macOS
npx electron-builder --win --config electron-builder.json  # Windows
```

打包输出目录: `release/`

# win 手动打包

```
cd /d D:\Meta-Lingo-Electron
call conda activate meta-lingo-electron
rmdir /s /q dist 2>nul & rmdir /s /q dist-electron 2>nul & rmdir /s /q release 2>nul & rmdir /s /q backend-dist 2>nul & rmdir /s /q backend\dist 2>nul & rmdir /s /q backend\build 2>nul
cd backend & pyinstaller --clean --noconfirm backend.spec & cd ..
move backend\dist backend-dist
set ELECTRON_MIRROR=https://cdn.npmmirror.com/binaries/electron/ && set ELECTRON_BUILDER_BINARIES_MIRROR=https://cdn.npmmirror.com/binaries/electron-builder-binaries/ && npm run build:frontend
set ELECTRON_MIRROR=https://cdn.npmmirror.com/binaries/electron/ && set ELECTRON_BUILDER_BINARIES_MIRROR=https://cdn.npmmirror.com/binaries/electron-builder-binaries/ && npx electron-builder --win --x64 --config electron-builder.json
explorer release
```

### 打包说明

- **打包后的应用包含完整的 Python 后端**，用户无需安装 Python 环境
- 应用启动时会自动启动后端服务
- 由于包含 ML 模型（Whisper、YOLO、CLIP 等），安装包体积较大（约 5-10GB）
- 首次启动可能需要较长时间加载模型

### Python 依赖打包配置 (2026-01-XX)

PyInstaller 打包配置 (`backend/backend.spec`) 已确保以下关键依赖正确打包：

- **wordcloud** (1.9.3): 词云图生成（旧版引擎），已添加到 hiddenimports 并收集数据文件
- **Pillow** (12.0.0): 图像处理库，已在 hiddenimports 中包含 PIL 和 PIL.Image
- **matplotlib** (3.10.8): 图表绘制库（wordcloud 服务需要），已从 excludes 移除并添加到 hiddenimports，收集字体和样式数据
- **plotly** (6.5.0): 交互式图表库（BERTopic 可视化），已添加到 hiddenimports 并收集数据文件

**注意**: 如果打包后出现依赖缺失错误，请检查 `backend/backend.spec` 中的 hiddenimports 和 datas 配置。

### macOS/Windows 打包注意事项 (2026-01-10)

macOS 文件系统会自动生成资源叉文件（以 `._` 或 `.__` 开头），这些元数据文件可能导致 Python 打包后出现 `UnicodeDecodeError`（特别是 matplotlib 尝试读取样式文件时）。如果代码在 macOS 上开发，这些文件也可能被带到 Windows 环境中。

**解决方案 - 三重防护机制**（macOS 和 Windows 均已实施）：

1. **PyInstaller spec 过滤**: `backend/backend.spec` 的 COLLECT 阶段会过滤所有 `._*` 和 `.__*` 文件
2. **PyInstaller 打包后清理**: 
   - macOS: `build.sh` 使用 `find` 命令清理 `backend-dist` 目录
   - Windows: `build.bat` 使用 PowerShell 清理 `backend-dist` 目录
3. **Electron Builder 打包后清理**: 
   - macOS: `build.sh` 清理最终 `.app` 包
   - Windows: `build.bat` 清理最终 `Meta-Lingo` 目录

这确保最终用户运行的应用中不包含任何会导致启动失败的资源叉文件。

### 窗口配置 (2024-12-26)

- **默认窗口尺寸**: 1400x930
- **最小窗口尺寸**: 1400x930 (固定最小尺寸，不允许缩小)
- **Windows 安装器**: 支持用户自定义安装路径 (NSIS `allowToChangeInstallationDirectory`)
- **Mac 标题栏融合**: 使用 `hiddenInset` 样式实现标题栏与页面顶部融合
  - 信号灯 (红黄绿按钮) 位于顶栏左侧
  - 顶栏支持拖拽移动窗口
  - 右侧工具按钮保持可点击

### 出厂状态清理 (2024-12-26)

打包脚本会自动执行以下清理操作，确保安装包处于出厂状态：

| 清理项 | 路径 | 说明 |
|--------|------|------|
| 语料库数据 | `data/corpora/*` | 用户上传的所有文本/音视频文件 |
| 标注存档 | `data/annotations/*` | 所有保存的标注会话和存档 |
| 主题建模数据 | `data/topic_modeling/*` | 嵌入向量和分析结果 |
| Word2Vec 模型 | `data/word2vec_models/*` | 训练的词向量模型 |
| 数据库文件 | `data/*.sqlite`, `data/*.db` | 所有数据库记录 (含文献可视化数据) |
| USAS 设置 | `data/settings/usas_settings.json` | 重置为默认 (清空自定义文本类型) |
| 标注框架 | `saves/frameworks/*` | 重置为默认框架 (删除用户自定义框架) |

**注意**: 打包前请确保已备份重要的测试数据！

---

## 开发状态

当前版本: **语料库管理完善 + 语料编辑功能(换行处理优化) + 标注模式简化 + SSE 实时进度 + SpaCy 集成 + 多模态标注完善 + 标注历史/框架管理/编码者间信度 + 词典查询(深色模式适配) + BERTopic主题建模 + 动态主题分析 + D3.js可视化重构v10 + 主题合并/自定义标签 + 主页4x3布局扩展(语义分析/词图分析/文献可视化) + CLIP视频图像语义分类+帧间隔配置+标注模式CLIP展示区+标注历史CLIP存档适配+D3太阳图+转录CLIP标签 + 词频统计UI统一(灰色参数条+圆角可视化图+统一下载控件+饼图居中填充+词云图界面一致)+词元统计(word/lemma选择+保留模式警告+全词词性匹配) + 共现关系重构(单页面布局+CQL查询引擎+6种搜索模式Sketch Engine标准+词性筛选位置调整+保留模式警告+全词词性匹配+CQL Builder可视化构建器) + UI美化统一(语料库列表+主页卡片扁平化设计+轻量交互+简约图标) + 标签页状态保持(多标签页并行工作+切换不丢失状态) + N-gram分析完善(2-6gram多选+Nest分组+词性筛选+D3.js可视化) + 同义词分析(WordNet+omw-1.4+SpaCy词性+D3网络图+过滤无同义词项) + LDA主题建模(Sklearn/Gensim双引擎+语言相关预处理+词性筛选+D3可视化) + LDA动态主题分析(LdaSeqModel+时间演化+桑基图+热力图) + LSA主题建模(TruncatedSVD+TF-IDF+解释方差优化+D3可视化) + NMF主题建模(sklearn NMF+重构误差优化+稀疏度指标+D3可视化) + USAS语义域标注(PyMUSAS+话语域识别+一文一义消歧+优先级配置+仅中英文) + 语义域分析(USAS数据分析+词性筛选+双视图结果+D3可视化) + BERTopic离群值预估修复 + 关键词提取重构(单文档算法TF-IDF/TextRank/YAKE/RAKE+关键性对比9种统计方法+D3可视化) + Word Sketch词图分析(50种语法关系+logDice显著性+Word Sketch Difference双词对比+可视化空状态+布局修复+词图对比可视化+空值检查修复白屏问题+卡片全部展开+展开箭头+独立高度+颜色优化word1蓝word2红+共现关系联动高亮搭配词+CQL精确联动) + CQL Builder可视化查询构建器(元素卡片+Token编辑器+模板管理+头词属性支持) + 文献可视化(Refworks解析WOS/CNKI+文献库管理+D3.js网络图/时间线/时区/突增检测) + 使用手册双语支持(zh.md/en.md+模块/章节双层导航+语料库管理详细教程) + 打包优化(Win安装路径自选+Mac标题栏融合+窗口最小尺寸1200x800+恢复出厂设置英文翻译) + 深色模式全面适配(语料库详情文本预览/共现关系展开上下文/词图分析卡片/词图对比示意色条/语义域顶部统计条/文献可视化网络图tag和甘特图/标注框架canvas/编码者信度Results面板) + 智能句子分割增强(句子边界后处理修复SpaCy parser覆盖问题+前后端逻辑统一避免索引错乱) + 跨模块链接修复(使用Menu TransitionProps.onExited确保菜单关闭动画完成后再跳转，修复首次跳转界面无法操作问题) + 词图共现关系精确联动(CQL查询生成+依存关系约束+头词属性扩展+上下文高亮偏移修复) + 标注模式文本关联增强(存档textId精确关联+按文本筛选历史存档+文本修改后显示最新内容) + 编码者间信度重构(索引-标签矩阵计算+ReCal样式结果面板+配对详情展示) + 成分语法打包路径修复 + 编码者间信度黄金标准功能(标准答案选择+召回率/精确率计算+按标签编码者分组结果) + 文本标注搜索批量标注(搜索高亮+精确词匹配+批量标注弹窗确认) + 转录文本搜索批量标注 + 重新标注顺序处理优化(仅处理选中文本+逐个处理+独立进度条+SpaCy异步API) + SpaCy重新标注支持音视频+编辑保存后自动重新标注(同步处理，与纯文本一致) + 文本标注分段优化(原生换行优先分段+排除空行+优先级：原生换行>Markdown边界>句子标点) + **SpaCy长文本分块处理(超长文本自动分块+智能句子边界切分+索引自动调整+进度实时反馈)** (2026-01-XX) + **许可证打包与查看** (2026-01-10 新增): LICENSE_CN.txt 和 LICENSE_EN.txt 打包进应用，设置页面新增许可证查看入口，根据语言自动显示对应版本**

- [x] 前端 UI 设计和组件
- [x] **多标签页管理系统** (2024-12-17 状态保持)
  - [x] 标签页状态保持：切换标签页时保持所有状态，不会丢失操作
  - [x] 多标签页并行工作：可同时打开多个模块标签页进行工作
  - [x] 标签页关闭时自动清理资源
- [x] 国际化 (中/英)
- [x] 后端 API 路由结构
- [x] **语料库管理** (2024-12-15 更新)
  - [x] SQLite 数据库集成 (元数据、标签、任务)
  - [x] 多模态文件上传 (文本/音频/视频)
  - [x] Whisper 转录服务 (词级时间戳)
  - [x] YOLO 视频标注服务 (对象追踪)
  - [x] **CLIP 视频图像语义分类** (2024-12-15/16 更新)
    - [x] 上传时可选启用 CLIP 标注
    - [x] 预设标签分类 (Object/Scene/Emotion/Action)
    - [x] 支持自定义标签
    - [x] **可配置帧间隔** (2024-12-16): 上传和重新标注时可设置 (默认30，设为1逐帧标注)
    - [x] 逐帧语义分类，结果存储为 JSON
    - [x] 详情页重新进行 CLIP 标注 (支持帧间隔选择对话框)
  - [x] **SSE 实时进度** (Server-Sent Events 推送处理进度)
  - [x] **异步处理流程** (音视频后台处理，实时进度反馈)
  - [x] **处理阶段可视化** (显示提取音频/转录/SpaCy/YOLO/CLIP/保存阶段)
  - [x] **YOLO/CLIP 进度显示** (2024-12-15): 勾选YOLO/CLIP时进度条正确显示对应阶段
  - [x] **SpaCy 自动标注** (上传时同步执行)
  - [x] **SpaCy 批量标注** (语料库详情页一键标注所有文本)
  - [x] **USAS 语义域标注** (2024-12-19 新增, 2026-01-24 三模式支持)
    - [x] PyMUSAS 语义标注引擎集成 (中英文)
    - [x] 上传时默认自动进行语义域标注
    - [x] 话语域识别消歧 (统计21大类标签占比)
    - [x] 一文一义消歧 (同词同文章统一标签)
    - [x] 设置页面语义域优先级配置
    - [x] 语料详情页 USAS 重新标注按钮
    - [x] 语言选择过滤 (仅中英文)
    - [x] **三种标注模式** (2026-01-24 新增):
      - [x] 规则消歧 (rule_based): PyMUSAS 规则标注 + 自定义消歧
      - [x] 神经网络 (neural): PyMUSAS-Neural 模型直接预测
      - [x] 混合模式 (hybrid): 规则 + 神经网络处理未知词
    - [x] 设置页面标注模式选择 (2026-01-24 新增)
  - [x] 完整 CRUD API
  - [x] 双级标签系统
  - [x] 上传面板 (拖拽上传、处理选项、实时进度)
  - [x] **语料库列表** (2024-12-17 扁平化美化v2)
    - [x] 卡片视图: 纯色背景、简洁边框、适度圆角
    - [x] 统计信息网格: 淡色背景+边框、信息清晰
    - [x] 轻量交互: 4px悬停抬升、淡阴影、平滑过渡
    - [x] 简约图标: 淡色背景、主题色图标
    - [x] outlined标签: 边框样式、透明背景、现代感
    - [x] 表格视图: 清晰的列表展示
    - [x] 筛选功能: 搜索、语言、标签
  - [x] 语料库详情 (文本列表、内容预览)
  - [x] **语料编辑功能** (2024-12-14 新增)
    - [x] 文本语料直接编辑
    - [x] 音视频转录文本逐句编辑
    - [x] 实体提取 (邮箱/网址/电话/IP)
    - [x] 文本标准化 (Unicode/空白/特殊字符/HTML/控制字符/换行处理)
    - [x] 查找/替换 (正则表达式、大小写敏感)
- [x] **文本预处理** (各模块独立配置)
  - [x] 多语言停用词支持 (28 种语言)
  - [x] 中文分词 (jieba)
  - [x] 实体提取 (SpaCy)
  - [x] 自定义停用词
  - [x] 高级正则清理
  - [x] 各分析模块独立预处理配置 UI
- [x] **标注模式** (2024-12-16 更新, 2026-01-02 增强)
  - [x] JSON 格式框架管理
  - [x] D3.js 框架树可视化 (层级/标签形状区分，颜色区分)
  - [x] **框架树导出 PNG** (2026-01-02 新增): 高清 PNG 导出 (2x 分辨率)
  - [x] **纯文本标注** (2024-12-16 更新, 2026-01-02 增强, 2026-01-06 搜索批量标注)
    - [x] **搜索批量标注功能** (2026-01-06 新增):
      - [x] 工具栏搜索框
      - [x] 精确词语匹配 (`\b` 正则边界)
      - [x] 匹配高亮显示
      - [x] 弹窗确认批量标注
    - [x] 分句显示划词标注 (每句单行，标签块精确对齐)
    - [x] **智能句子分割** (2026-01-02 增强, 2026-01-08 原生换行优先): 正确处理邮箱、URL、人名缩写、小数等特殊情况
      - [x] **后端句子边界后处理**: SpaCy 处理后自动校正，修复 parser 覆盖问题
      - [x] **前后端逻辑一致**: 后端和前端 fallback 使用相同分割逻辑，避免索引错乱
      - [x] **原生换行优先** (2026-01-08 新增): 优先尊重文本原生换行符（排除空行）进行分段
    - [x] **Markdown 结构分段** (2026-01-02 修复): 支持 `#` 标题、`- * +` 列表、`1. 2.` 有序列表、`>` 引用、空行分隔（修复列表项逐词分段问题）
    - [x] 层叠标注显示 (大标签在上，禁止交叉)
    - [x] PNG/SVG 导出优化 (自适应背景，边距 padding，长句完整显示)
    - [x] 标注表格 POS/NER 列 (使用 SpaCy 标注数据)
    - [x] **SpaCy 数据存档** (2026-01-02): 存档保存/加载时自动保存/恢复 SpaCy 标注数据
    - [x] **文本更新同步** (2026-01-02 修复): 语料库管理中修改文本后，标注模式显示最新内容并自动重新生成 SpaCy 数据
    - [x] SpaCy 预标注显示 (NER/POS 切换)
    - [x] **简化交互**: 选择文本后直接显示标注界面 (移除预处理选项和开始标注按钮)
    - [x] **标签块严格对齐**: 标签块宽度严格限制在划词范围内，不超出边界
    - [x] **深色模式适配** (2024-12-16): 文本标注容器背景和边框自动适配深色主题
    - [x] **自动标注功能** (2026-01-28 新增):
      - [x] 句法结构按钮右侧新增"自动标注"按钮
      - [x] 仅 MIPVU / Halliday-Theme / Berry-Theme 框架可用
      - [x] MIPVU: 自动标注隐喻词为 `indirect`
      - [x] Theme/Rheme: 基于 SFL 理论自动标注主题/述题（段落级别）
      - [x] 后端 Theme 分析服务
      - [x] 前端工具函数
      - [x] 双语界面支持
  - [x] **多模态标注** (2024-12-16 更新)
    - [x] 视频播放控制 (-5s/+5s, 上/下一帧, 播放/暂停)
    - [x] 画框模式 (开启画框, 框信息显示, videoScale 坐标映射)
    - [x] **帧追踪系统** (帧间隔设置, 追踪到上/下一帧, 确认框选, 保存序列)
    - [x] **关键帧插值** (多关键帧自动线性插值)
    - [x] **DAW 范式播放针** (三阶段行为: 移动->居中->移动)
    - [x] **多轨时间轴** (YOLO追踪/转录段/用户标注/关键帧, 点击跳转)
    - [x] **YOLO 叠加显示** (使用视频原始坐标绘制检测框)
    - [x] **转录文本标注**: 标签块方式，禁止交叉，大标签在上，与纯文本配色一致
    - [x] **UI 简化**: 移除左侧 SpaCy 开关和多余标注层显示
    - [x] **转录句子竖条高亮** (灰色/标注色/绿色, 时间轴联动)
    - [x] **标注表格 SpaCy 集成**: 正确显示词性和命名实体
    - [x] **转录文本搜索批量标注** (2026-01-06 新增): 与纯文本一致的搜索高亮和批量标注功能
    - [x] **YOLO 数据 API** (加载视频的物体追踪结果)
    - [x] **CLIP 展示区** (2024-12-16): 帧间隔下方新增 CLIP 置信度进度条展示区
    - [x] **深色/浅色模式适配** (2024-12-16): 字幕区和 CLIP 展示区配色自动适配主题
  - [x] 对接语料库管理 (加载语料库文本/视频/音频)
  - [x] 框架导入工具 (从旧版文件夹格式导入)
  - [x] 49 个预置框架 (SFL、UAM、元话语分析等)
  - [x] **标注历史管理** (2024-12-16 更新, 2026-01-02 增强)
    - [x] **全局存档列表** (2026-01-02 优化): 显示所有存档，点击自动切换语料库
    - [x] **级联删除** (2026-01-02 新增): 删除文本时自动删除关联的标注存档
    - [x] **语料库/文本重命名安全** (2026-01-02): 重命名时同步更新存档目录和内容
    - [x] **文本与存档精确关联**: 存档通过 textId 精确关联
    - [x] 存档显示所属语料库名称
    - [x] **CLIP 数据存档支持** (2024-12-16): 多模态存档完整保存/加载 CLIP 语义分类数据
    - [x] **直接导出**: 点击导出按钮直接下载（以存档名命名）
    - [x] **详情页面**: 点击卡片查看完整标注数据
    - [x] 文本标注表格（排序/筛选/搜索/导出CSV）
    - [x] 视频标注表格（CLIP分类 + YOLO检测 + 手动标注）
    - [x] **D3.js 交互式可视化** (2024-12-16 重构, 2024-12-17 太阳图): 支持导出 PNG/SVG
      - [x] **文本标注可视化**: D3.js 柱状图/饼图
      - [x] **多模态时间线图**: YOLO/手动散点 + CLIP 折线背景 + 双Y轴
      - [x] **太阳图**: YOLO/手动标注层级分布，点击展开/缩放，平滑过渡动画
      - [x] **热图**: YOLO/手动标注时间分布
    - [x] 搜索和筛选
    - [x] 批量导出 JSON
    - [x] 删除存档
  - [x] **框架管理** (2024-12 新增)
    - [x] 框架列表展示
    - [x] 创建新框架
    - [x] 框架树预览
    - [x] 复制/导入/导出框架
    - [x] 删除框架
  - [x] **编码者间信度分析** (2024-12-14 修复, 2026-01-05 重构, 2026-01-06 黄金标准)
    - [x] 数据验证 (文本一致性、框架一致性)
    - [x] **黄金标准/标准答案功能** (2026-01-06 新增):
      - [x] 选择存档作为标准答案
      - [x] 召回率和精确率计算
      - [x] 按标签和编码者分组展示结果
    - [x] **索引-标签矩阵计算** (2026-01-05 新增):
      - [x] 基于字符索引的二值矩阵
      - [x] 标签覆盖索引记为1，否则为0
      - [x] 支持重叠标注
    - [x] **信度系数** (2026-01-05 重构，参考 ReCal):
      - [x] Average Pairwise Percent Agreement (配对详情)
      - [x] Fleiss' Kappa (Observed/Expected Agreement)
      - [x] Average Pairwise Cohen's Kappa (配对详情)
    - [x] Krippendorff's Alpha (多测量层次)
    - [x] **ReCal 样式结果面板** (2026-01-05 新增):
      - [x] 数据概览区 (N coders / N cases / N decisions)
      - [x] 每个系数独立卡片展示
      - [x] 配对详情表格
    - [x] 结果表格和柱状图
    - [x] HTML/CSV 报告导出
    - [x] KWIC 索引
    - [x] **修复**: 存档加载字段兼容性 (startPosition/endPosition <-> position/end_position)
    - [x] 标注详情比对
- [x] **词典查询** (2024-12-14 新增)
  - [x] 后端词典服务 (懒加载、LRU缓存、模糊搜索)
  - [x] 词典 API (列表、查询、建议、缓存管理)
  - [x] 前端词典弹窗 (搜索框集成)
  - [x] 多词典支持 (麦克米伦、朗文搭配)
  - [x] 各词典专属样式 (红色/蓝紫色主题)
  - [x] **深色模式适配** (2024-12-15 新增): 词典内容、面包屑、滚动条全面适配
  - [x] 面包屑导航 (查询历史追踪)
  - [x] 词条内链接跳转 (entry:// 链接)
  - [x] 输入自动建议
  - [x] 模糊搜索 (前缀匹配、包含匹配)
- [x] **主页** (2024-12-17 扁平化美化)
  - [x] 4列x3行布局 (12个功能入口)
  - [x] **扁平化卡片设计**: 轻量悬停抬升(4px)、淡阴影、主题色边框高亮
  - [x] **充实卡片**: 最小高度220px、图标容器96x96、图标52px
  - [x] **简约图标容器**: 淡色背景+边框、轻微放大(1.05倍)
  - [x] **适度文字排版**: 标题(h6, 1.15rem)、描述(body2, 0.9rem)
  - [x] **平衡布局**: 顶底留白一致(pt/pb: 3)、网格间距3、内边距py: 4
  - [x] 毛玻璃效果支持(壁纸模式)
  - [x] 语义分析页面框架 (语义域与语义关系分析)
  - [x] 词图分析页面框架 (词语语法搭配模式分析)
  - [x] 文献可视化页面框架 (文献数据可视化分析)
- [x] **词频统计** (2024-12-16 UI统一, 2024-12-17 词元统计)
  - [x] 词频分析后端服务 (word_frequency_service.py)
  - [x] 词性筛选 (SpaCy Universal POS，保留/过滤模式)
    - [x] **保留模式警告** (2024-12-17): 保留模式下未选择词性时显示警告
  - [x] **搜索目标选择** (2024-12-17 新增):
    - [x] 词形(word): 按原始形式统计
    - [x] 词元(lemma): 使用SpaCy标注的词元统计
  - [x] 高级检索 (最大/最小频率、最小词长、多种搜索类型)
  - [x] 排除词和全转小写支持
  - [x] 前端三栏布局 (参考主题建模)
  - [x] **可视化界面统一设计** (2024-12-16):
    - [x] 统一灰色参数条 (所有图表类型)
    - [x] D3.js 柱状图 (填充容器、SVG导出)
    - [x] D3.js 饼图 (居中填充、响应式布局)
    - [x] D3 词云图 (移除内部设置面板、统一下载控件)
    - [x] 圆角可视化图背景 (#fafafa)
  - [x] 结果表格 (排序、分页、导出)
  - [x] 中英文翻译支持
- [x] **共现关系** (2024-12-17 重构, 2024-12-18 搜索模式升级, 2024-12-24 CQL Builder)
  - [x] 单页面布局设计 (左配置面板 + 右结果区域)
  - [x] 删除旧模式 (词图、常规模式、语法模式)
  - [x] **CQL Builder 可视化构建器** (2024-12-24 新增):
    - [x] 参考Sketch Engine CQL Builder设计
    - [x] 元素卡片: 普通Token、任意Token、距离、OR运算符
    - [x] Token编辑器: 属性(word/lemma/pos/tag/dep)、运算符(=/!=/==/!==)
    - [x] 多条件组合: AND/OR逻辑连接
    - [x] 实时CQL预览和语法验证
    - [x] 模板管理: 内置示例模板、自定义模板保存
    - [x] 双入口: 共现关系页面标题栏、CQL编辑器内
  - [x] 后端服务模块 (collocation/)
    - [x] CQL查询引擎 (cql_engine.py): 增强版Sketch Engine语法实现
    - [x] KWIC搜索服务 (kwic_service.py): **6种搜索模式 (2024-12-18)**
    - [x] 词性筛选 (pos_filter.py): Universal POS/Penn Treebank/依存关系标签
  - [x] **6种搜索模式** (2024-12-18 基于Sketch Engine重构):
    - [x] Simple: 词形/词元匹配，通配符支持 (*, ?, |, --)
    - [x] Lemma: 词元搜索，正则表达式支持
    - [x] Phrase: 短语精确匹配，正则表达式支持
    - [x] Word: 词形精确匹配，正则表达式支持
    - [x] Character: 包含字符/字符串搜索
    - [x] CQL: 语料库查询语言
  - [x] CQL语法支持:
    - [x] 属性匹配: word/lemma/pos/tag/dep
    - [x] 逻辑运算: AND(&)、OR(|)、NOT(!)
    - [x] 序列匹配: []任意token、[]{n}重复、[]{min,max}范围、[]?可选
    - [x] 运算符: =正则、==精确、!=正则不匹配、!==精确不匹配
    - [x] 正则表达式: [word=".*ing"]等
  - [x] **词性筛选** (2024-12-18 位置调整):
    - [x] 移到搜索配置上方
    - [x] SpaCy POS标签多选，保留/过滤模式
    - [x] 保留模式空选警告
    - [x] 全词匹配: 结果每词都需满足词性条件
    - [x] CQL优先级高于词性筛选
  - [x] A=a: 忽略大小写选项
  - [x] 排序对话框: 1L-3L/KWIC/1R-3R位置、Word/Lemma/POS属性、忽略大小写、Retrograde
  - [x] 筛选对话框: 基础/高级模式、包含/不包含、多种查询类型、范围选择
  - [x] KWIC结果表格: 颜色标记上下文、来源列前置、行内展开上下文、分页、CSV导出
  - [x] CQL编辑器: 语法高亮、实时验证、示例模板、CQL Builder入口
  - [x] D3.js可视化 (简化): 密度分布图、分组山脊图 (删除热力图、散点图、覆盖率图、模式图)
  - [x] 前端React组件模块化设计
  - [x] 双语翻译支持 (中/英)
- [x] **N-gram 分析** (2024-12-18 完善)
  - [x] N-gram分析后端服务 (ngram_service.py)
  - [x] 支持 2-6 gram 多选
  - [x] Nest N-gram 分组 (短N-gram作为长N-gram子集分组)
  - [x] 词性筛选 (SpaCy Universal POS，保留/过滤模式)
  - [x] 高级检索 (频率范围、最小词长、多种搜索类型)
  - [x] 排除词和全转小写支持
  - [x] 前端三栏布局 (参考词频统计)
  - [x] 结果表格 (支持Nest展开)
  - [x] **D3.js 可视化**:
    - [x] 柱状图 (水平条形图)
    - [x] 网络图 (力导向图)
    - [x] 桑基图 (词序流动)
    - [x] 词云图
  - [x] 双语翻译支持
- [x] **同义词分析** (2024-12-18 新增，替代词族统计, 2024-12-25 过滤优化)
  - [x] NLTK WordNet + omw-1.4 本地数据
  - [x] SpaCy 标注数据词性提取
  - [x] 词性筛选 (auto/adjective/adverb/noun/verb/pronoun)
  - [x] 三栏布局 (参考词频统计)
  - [x] 同义词集详情 (定义、例句、同义词)
  - [x] D3.js 同义词网络图可视化
  - [x] 结果表格可展开查看同义词集
  - [x] **自动过滤无同义词项** (2024-12-25): 分析结果自动过滤同义词数为0的项目
  - [x] CSV 导出
  - [x] 双语翻译支持
- [x] **语义域分析** (2024-12-19 新增)
  - [x] 语义域分析后端服务 (semantic_analysis_service.py)
  - [x] 词性筛选 (SpaCy Universal POS，保留/过滤模式)
  - [x] 高级检索 (最大/最小频率、多种搜索类型)
  - [x] 排除词和全转小写支持
  - [x] 前端三栏布局 (参考词频统计)
  - [x] **双视图结果**: 按语义域统计 / 按词语统计
  - [x] **语义域详情弹窗**: 点击语义域查看该标签下的词汇
  - [x] **D3.js 可视化**: 柱状图 / 饼图
  - [x] 双语翻译支持
- [x] **关键词提取** (2024-12-21 新增, 2026-01-XX 白屏修复)
  - [x] 关键词提取后端服务 (keyword_service.py)
  - [x] **两大Tab设计**: 单文档算法 / 关键性对比
  - [x] **单文档算法**:
    - [x] TF-IDF (词频-逆文档频率)
    - [x] TextRank (基于PageRank的文本排序)
    - [x] YAKE! (Yet Another Keyword Extractor)
    - [x] RAKE (Rapid Automatic Keyword Extraction)
  - [x] **关键性对比 (Keyness)**:
    - [x] Log-Likelihood (对数似然比)
    - [x] Chi-squared (卡方检验)
    - [x] Log Ratio (对数比率)
    - [x] Dice Coefficient (Dice系数)
    - [x] Mutual Information (互信息)
    - [x] MI3 (立方互信息)
    - [x] T-score
    - [x] Simple Keyness (简单关键性)
    - [x] Fisher's Exact (Fisher精确检验)
  - [x] **关键性对比白屏修复** (2026-01-XX 新增): 修复 ResultsTable 组件中未定义变量引用导致的渲染崩溃
    - [x] 修复 `studyCorpus` -> `studySelection.corpus`
    - [x] 修复 `getStudyTextIds()` -> `getSelectedTextIds(studySelection, filteredStudyTexts)`
    - [x] 修复 `studySelectionMode` -> `studySelection.mode`
    - [x] 修复 `studySelectedTags` -> `studySelection.tags`
    - [x] 添加缺失的翻译键 `keyword.results.total`
  - [x] 双语料库选择 (研究语料库 vs 参照语料库)
  - [x] 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
  - [x] D3.js 可视化 (柱状图、饼图、词云图)
  - [x] 结果表格 (排序、导出、正负关键词标识)
  - [x] 双语翻译支持
- [x] **Word Sketch 词图分析** (2024-12-21 新增/修复, 2024-12-23 UI优化, 2024-12-26 共现关系联动)
  - [x] Sketch Grammar 引擎 (sketch_engine.py)
    - [x] 50种语法关系模板 (VERB/NOUN/ADJ/ADV/PRON)
    - [x] 基于SpaCy依存句法的关系提取
    - [x] 从SpaCy JSON重建Doc对象
  - [x] logDice 显著性计算 (log_dice.py)
  - [x] Sketch 服务 (sketch_service.py)
    - [x] Word Sketch 生成
    - [x] Word Sketch Difference 对比
    - [x] 语料文本 Sketch 标注
  - [x] 后端 API 路由 (sketch.py)
  - [x] **UI优化** (2024-12-23 新增)
    - [x] 卡片全部展开：所有关系卡片默认展开
    - [x] 展开更多箭头：添加向下箭头图标提示
    - [x] 卡片独立高度：修复同行卡片高度跟随问题
    - [x] 移除对比图例：简化界面
    - [x] 颜色优化：word1蓝色、word2红色
    - [x] 颜色梯度：从蓝到红 (6/4/2/0/-2/-4/-6) 分配
    - [x] 可视化颜色同步：DiffVisualization颜色与表格一致
    - [x] `/api/sketch/word-sketch` - 生成 Word Sketch
    - [x] `/api/sketch/difference` - 双词搭配对比
    - [x] `/api/sketch/annotate` - 单文本标注
    - [x] `/api/sketch/pos-options` - 词性选项
  - [x] **共现关系联动高亮+过滤** (2024-12-26 新增/完善)
    - [x] 点击搭配词跳转共现关系时，搜索主词并在上下文中高亮搭配词
    - [x] **上下文过滤**: 只显示上下文中包含搭配词的KWIC结果
    - [x] Word Sketch: 搜索主词(如progress)，过滤并高亮搭配词(如make)
    - [x] Word Sketch Difference: 根据搭配词归属选择主词搜索，过滤并高亮搭配词
    - [x] 橙色高亮样式，与KWIC关键词高亮区分
    - [x] 扩展上下文区域也支持高亮
  - [x] 前端页面 (WordSketch/)
    - [x] 两Tab设计: Word Sketch / Word Sketch Difference
    - [x] 三栏布局 (语料库选择/搜索配置/结果展示)
    - [x] BERTopic风格关系卡片
    - [x] D3.js 柱状图可视化
    - [x] 红/绿高亮独有搭配
    - [x] **白屏问题修复** (2024-12-21): 添加空值检查防止 undefined 属性访问导致渲染崩溃
  - [x] 前端 API 客户端 (sketch.ts)
  - [x] 双语翻译支持 (中/英)
- [x] **文献可视化** (2024-12-25 新增)
  - [x] 后端数据库模型 (biblio_libraries, biblio_entries 表)
  - [x] Refworks 文件解析器 (WOS/CNKI 两种格式)
  - [x] 网络构建服务 (合作网络/共现网络/共被引网络)
  - [x] 聚类分析服务 (Louvain/标签传播)
  - [x] 突增检测服务 (Kleinberg算法)
  - [x] 后端 API 路由 (文献库CRUD + 可视化数据)
  - [x] 前端类型定义和 API 客户端
  - [x] 上传面板 (格式选择 + 文件上传 + 校验)
  - [x] 文献库列表组件
  - [x] 文献库详情组件 (条目列表 + 筛选 + 详情弹窗)
  - [x] D3.js 网络图组件 (力导向图)
  - [x] D3.js 时间线视图组件
  - [x] D3.js 时区视图组件
  - [x] D3.js 突增检测图组件
  - [x] 可视化面板 (参数配置 + 图表展示)
  - [x] 主页面 Tab 切换布局
  - [x] 双语翻译支持
- [x] **主题建模** (2024-12-14 BERTopic, 2024-12-18 LDA, 2024-12-20 LSA/NMF)
  - [x] **BERTopic** (2024-12-14 新增, 2024-12-15 ECharts重构):
    - [x] BERTopic 后端服务 (preprocess/embedding/analysis/visualization)
    - [x] SBERT 嵌入 (paraphrase-multilingual-MiniLM-L12-v2)
    - [x] SpaCy 标注预处理
    - [x] 降维: UMAP, PCA
    - [x] 聚类: HDBSCAN, BIRCH, K-Means
    - [x] 向量器: CountVectorizer, TfidfVectorizer
    - [x] 离群值处理
    - [x] **离群值预估** (2024-12-21 修复): 
      - 修复预估接口传入embeddings参数使预估结果与实际处理一致
      - 将预估功能移至分析配置面板，与旧版逻辑一致
      - 策略和阈值参数始终显示（不启用离群值处理也可预估）
      - 需先运行分析再进行预估（与旧版一致）
    - [x] Ollama 智能主题命名
    - [x] **主题表示模型** (2024-12-15 新增):
      - [x] KeyBERTInspired (基于 KeyBERT 的关键词提取)
      - [x] MaximalMarginalRelevance (MMR 多样性优化)
      - [x] ZeroShotClassification (零样本分类)
      - [x] PartOfSpeech (词性模式)
      - [x] Ollama (连接后可用的 LLM 智能命名)
    - [x] 前端配置面板 (预处理/Embedding/分析/表示模型)
    - [x] 结果展示 (主题卡片/表格)
    - [x] **5种 D3.js 可视化** (2024-12-15 重构 v10):
      - 主题词条形图 (barchart) - 网格布局，横向条形图，权重值显示
      - **文档散点图** (documents) - 离群值灰色显示，UMAP 轴标签，**修复图例点击切换bug**
      - 相似性热图 (heatmap) - 主题相似度矩阵，蓝色渐变配色
      - **词项排名** (term_rank) - 词权重衰减折线图，**可配置词数量**，**悬停淡化其他主题**
      - 主题时间演化 (topics_over_time) - 折线图频率变化，图例交互高亮
      - ~~主题气泡图/层次聚类图~~ - 已移除
    - [x] **主题合并** (2024-12-15 新增): 选择多个主题进行合并，使用BERTopic merge_topics方法
    - [x] **自定义标签** (2024-12-15 新增): 手动编辑主题名称，覆盖默认或AI生成的名称
    - [x] **主题详情表格美化** (2024-12-15 更新): 渐变色标题栏、斑马纹行、权重条形图归一化显示
    - [x] 可视化参数配置面板:
      - 每种可视化类型独立参数
      - 主题数量、词数、采样大小等
      - 自定义标签支持
      - 实时重新生成
    - [x] 双语翻译支持
    - [x] **动态主题分析** (2024-12-14 新增)
      - [x] 基于语料元数据日期的时间序列分析
      - [x] 日期格式选择 (仅年份/完整日期)
      - [x] 时间段数量配置 (nr_bins)
      - [x] 演化调整和全局调整选项
      - [x] 主题时间演化可视化 (ECharts 折线图)
  - [x] **LDA** (2024-12-18 新增, 2024-12-21 动态分析):
    - [x] LDA后端服务 (lda_preprocess_service.py, lda_service.py)
    - [x] 双引擎支持: Scikit-learn 和 Gensim
    - [x] 语言相关预处理 (中文jieba分词/英文SpaCy分词)
    - [x] 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
    - [x] 预处理预览功能 (处理前后对比)
    - [x] 完整参数配置 (Alpha/Eta/迭代次数/学习方法等)
    - [x] 模型评估指标 (困惑度/一致性/对数似然)
    - [x] 主题数优化功能
    - [x] 前端Tab集成 (BERTopic/LDA切换)
    - [x] D3.js 可视化 (主题词条形图/主题分布饼图/文档分布图)
    - [x] **LDA 动态主题分析** (2024-12-21 新增):
      - [x] 基于 Gensim LdaSeqModel 的动态主题建模
      - [x] 利用语料元数据日期进行历时研究
      - [x] 日期格式选择和时间段配置
      - [x] 动态主题配置面板 (LDADynamicPanel.tsx)
      - [x] D3.js 主题时间演化折线图 (LDATopicTimeline.tsx)
      - [x] D3.js 相似度热力图 (LDASimilarityHeatmap.tsx)
      - [x] D3.js 主题演化桑基图 (TopicEvolutionSankey.tsx)
      - [x] 新增 API 端点 (analyze-dynamic, topics-over-time, topic-transitions)
    - [x] 双语翻译支持
  - [x] **LSA** (2024-12-20 新增):
    - [x] LSA后端服务 (lsa_service.py)
    - [x] 基于 TruncatedSVD 的潜在语义分析
    - [x] TF-IDF 文档-词矩阵构建
    - [x] 语言相关预处理 (复用LDA预处理服务)
    - [x] 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
    - [x] 预处理预览功能 (处理前后对比)
    - [x] 完整参数配置 (SVD算法/最大特征数/收敛容差等)
    - [x] 模型评估指标 (解释方差比/累积方差/奇异值和)
    - [x] 主题数优化功能 (弹窗形式D3.js解释方差曲线)
    - [x] 前端Tab集成 (BERTopic/LDA/LSA切换)
    - [x] D3.js 可视化 (主题词条形图/方差图/文档分布图)
    - [x] 双语翻译支持
  - [x] **NMF** (2024-12-20 新增):
    - [x] NMF后端服务 (nmf_service.py)
    - [x] 基于 sklearn NMF 的非负矩阵分解
    - [x] TF-IDF 文档-词矩阵构建
    - [x] 语言相关预处理 (复用LDA预处理服务)
    - [x] 词性筛选 (SpaCy Universal POS, 保留/过滤模式)
    - [x] 预处理预览功能 (处理前后对比)
    - [x] 完整参数配置 (初始化方法/求解器/正则化参数等)
    - [x] 模型评估指标 (重构误差/稀疏度/迭代次数)
    - [x] 主题数优化功能 (弹窗形式D3.js重构误差曲线)
    - [x] 前端Tab集成 (BERTopic/LDA/LSA/NMF切换)
    - [x] D3.js 可视化 (主题词条形图/主题分布饼图/文档分布图)
    - [x] 双语翻译支持

---

## 版本更新记录

### v3.8.95 (2026-01-28)
- **优化**: 纯文本标注模式支持音视频转录文本的句法可视化
  - **句法可视化**: 选择视频/音频转录文本时，句法结构按钮可用
  - **数据格式转换**: 后端自动将 segment-based SpaCy 数据转换为前端期望的统一格式
- **调整**: 音视频转录文本禁用自动标注功能
  - 由于 segment-based 数据格式与自动标注的复杂性，暂时禁用音视频的 MIPVU 和 Theme/Rheme 自动标注
  - 自动标注按钮对音视频转录文本显示为禁用状态，并显示相应提示
- **修复**: MIPVU 标注数据读取问题
  - **metaphor_analysis_service**: 支持从 segments 中提取 mipvu_data
  - **SpaCy 数据合并**: 在调用 MIPVU 前正确合并 SpaCy 标注数据到 segments

### v3.8.94 (2026-01-28)
- **优化**: 音视频转录完整标注流程
  - **音频上传**: 上传音频文件后，转录文本自动执行 SpaCy + USAS + MIPVU 标注（与文本上传一致）
  - **视频上传**: 上传视频文件后，转录文本自动执行 SpaCy + USAS + MIPVU 标注（与文本上传一致）
  - **SpaCy 重新标注**: 对音视频文件点击"完整重新标注"按钮，现在会执行 SpaCy + USAS + MIPVU 全流程（与文本重新标注一致）
  - **进度显示**: 上传和重新标注时正确显示各阶段进度（转录 → SpaCy → USAS → MIPVU）
  - **语言支持**: USAS 支持中文和英文，MIPVU 仅支持英文

### v3.8.93 (2026-01-28)
- **新功能**: 关键词提取增强
  - **停用词过滤**: 单文档和关键性对比均支持停用词过滤
    - 根据语料库语言自动加载 NLTK 停用词
    - 支持自定义排除词列表（一行一词或逗号分隔）
  - **语料库资源**: 关键性对比支持使用预构建语料库作为参照
    - 新增语料库资源服务 (`corpus_resource_service.py`)
    - 支持 BNC、Brown、NOW、OANC 四个预构建语料库词频数据
    - 资源选择对话框：搜索框、语料库类型筛选、标签筛选
    - 自动名称映射（如 `bnc_commerce_finance` → `BNC(Commerce & Finance)`）
    - 资源卡片显示词汇数量、文件大小、描述信息
  - **统计阈值**: 关键性对比支持学术统计阈值过滤
    - 最小分数阈值（如 LL > 6.63 对应 p < 0.01）
    - 最大 p 值阈值（标准 0.05，严格 0.01）
    - 预设学术标准参考
  - **新增 API**: `/api/corpus-resource/*` 系列端点
  - **新增组件**: `CorpusResourceCard`、`CorpusResourceDialog`
  - **文档更新**: 帮助文档（zh.md、en.md）新增相关说明

### v3.8.92 (2026-01-28)
- **新功能**: 标注模式自动标注按钮
  - 在句法结构按钮右侧新增"自动标注"按钮（绿色图标）
  - **框架支持**: 仅当框架为 MIPVU / Halliday-Theme / Berry-Theme 时可点击
  - **MIPVU 自动标注**: 根据语料库管理的 MIPVU 标注数据，自动对文中隐喻词标注 `indirect` 标签
  - **Theme/Rheme 自动标注**: 利用 SpaCy 标注信息，基于 SFL 理论自动识别并标注主题/述题
    - 段落级别标注（如 "The Duke" 整段划词标注为 theme）
    - Theme: 从句首到第一个概念主题（通常是主语）
    - Rheme: Theme 之后的所有内容
  - **后端服务**: 新增 Theme/Rheme 分析服务 (`backend/services/theme_analysis_service.py`)
  - **API 端点**: 新增 `/api/annotation/auto-annotate/theme-rheme` 和 `/api/annotation/auto-annotate/supported-frameworks`
  - **前端工具**: 新增 `src/utils/autoAnnotation.ts` 自动标注工具函数
  - **双语支持**: 中英文界面翻译完整

### v3.8.91 (2026-01-28)
- **文档更新**: 使用手册新增隐喻分析章节
  - 在语义分析模块下新增完整的"隐喻分析"使用说明
  - 详细描述 MIPVU 标注方法原理和四步混合检测流程
  - 引用 HiTZ 团队的 DeBERTa 隐喻检测模型和相关论文
  - 提供检测可靠性数据（F1: 78.7%, 精确率: 76.86%, 召回率: 80.53%）
  - 说明微调模型对 IN/DT/RB/RP 词性的改进效果
- **文档更新**: 共现关系模块新增"高亮隐喻"功能说明
  - 工具栏新增"高亮隐喻"开关
  - 隐喻词以琥珀色背景高亮显示
- **文档更新**: 语义域分析模块新增"高亮隐喻词"功能说明
  - 在"按词语"模式下支持高亮显示隐喻词
  - 隐喻词以绿色加粗样式显示
  - CSV 导出时隐喻词以 `**word**` 标记
- **文档结构优化**: 语义域分析章节标题层级调整
  - 将"语料选择"、"结果模式选择"、"词性筛选"等调整为三级标题
  - 使用手册结构与隐喻分析章节保持一致
- **文档更新**: 理论基础新增 MIPVU 隐喻理论
  - 在"# 语义分析"的理论基础部分新增 MIPVU 标注方法说明
  - 包含基本义/上下文义概念解释和参考文献
- **双语支持**: 中英文使用手册同步更新

### v3.8.89 (2026-01-25)
- **新功能**: 自定义壁纸上传
  - 在应用设置新增上传壁纸选项
  - 壁纸占满页面标签栏以下的容器区域
  - 壁纸随窗口伸缩等比放大 (object-fit: cover)，不会扭曲图片
  - 支持上传、预览、更换和移除壁纸
  - 支持透明度滑块调节 (5%-50%)
  - 移除了原有的 GDUFS 水印背景
- **新功能**: 词频统计移除停用词
  - 在搜索配置面板的排除词模块新增"移除停用词"开关
  - 根据语料库语言自动加载对应的 NLTK 停用词
  - 支持中文、英文及其他 20+ 种语言的停用词
- **优化**: 主页"语义域分析"更名为"语义分析"
  - 便于日后扩展更多语义分析功能
  - 内部的语义域分析功能保持不变

### v3.8.88 (2026-01-24)
- **新功能**: USAS 标注模式选择
  - **三种标注模式**: 规则消歧 (rule_based) / 神经网络 (neural) / 混合模式 (hybrid)
  - **规则消歧**: 使用 PyMUSAS 规则标注器，结合话语域识别和一文一义规则进行消歧，支持 MWE 识别
  - **神经网络**: 使用 PyMUSAS-Neural-Multilingual-Base-BEM 模型直接预测，每个词输出唯一标签
  - **混合模式**: 先用规则标注，对未知词 (Z99) 使用神经网络预测，然后执行消歧规则
  - **应用设置**: 新增 USAS 标注模式设置面板，可选择标注模式
  - **API 支持**: 新增 `/api/usas/mode` GET/PUT 端点，支持获取和设置标注模式
  - **依赖更新**: 新增 wsd-torch-models 依赖

### v3.8.87 (2026-01-21)
- **新功能**: LDA/LSA/NMF CSV导出增加主题名称列
  - CSV导出表格在 Topic ID 列右侧新增 Topic Name 列
  - 主题名称优先使用自定义标签，如无则使用前3个关键词生成的默认名称
  - 方便论文写作和数据分析时快速识别主题内容

### v3.8.86 (2026-01-18)
- **新功能**: LDA/LSA/NMF 主题命名和自定义标签功能
  - **Ollama 主题命名**: 使用 Ollama LLM 为 LDA/LSA/NMF 主题生成名称 (与 BERTopic 一致)
  - **自定义标签编辑**: 每个主题卡片添加编辑标签按钮，支持手动设置自定义标签
  - **可视化自定义标签**: 可视化面板添加"使用自定义标签"复选框，可在图表中显示自定义标签
  - **BERTopic 命名优化**: 改进提示词，生成更清晰的主题名称，使用驼峰命名 (camelCase)
  - **后端 API**: 新增 6 个端点支持 LDA/LSA/NMF 的主题命名和标签更新
  - **类型定义**: LDATopic/LSATopic/NMFTopic 类型添加 custom_label 字段

### v3.8.78 (2026-01-XX)
- **修复**: 打包后软件许可证显示 "Failed to fetch" 错误
  - 根因：使用绝对路径 `fetch('/')` 在 Electron 打包后的 `file://` 协议下无法正确访问文件
  - 解决：改为相对路径 `fetch('./')` 以兼容 Vite 的 `base: './'` 配置
  - 现在许可证文件可以正常加载和显示
- **修复**: pyLDAvis 可视化在打包后加载缓慢（约70秒）
  - 根因：PyInstaller 打包后的 Python 可执行文件使用 joblib 多进程时会崩溃（frozen executable 的 fork 问题）
  - 现象：首次尝试 pcoa 等待约48秒后 worker 崩溃，回退到 mmds 又等待约22秒后崩溃，最终使用 n_jobs=1 成功
  - 解决：强制所有策略使用单线程模式 `n_jobs=1`，跳过会崩溃的多进程计算
  - 效果：加载时间从约70秒减少到几秒，直接使用单线程计算无需等待多进程超时
- **优化**: 调整应用窗口最小尺寸
  - 窗口最小宽度（长边）从 1400 调整为 **1458**

### v3.8.77 (2026-01-11)
- **修复**: 标注模式框架管理多项问题
  - 修复创建新框架后删除按钮不可用的问题
    - 之前只有 'Customs' 分类的框架可删除，现改为除预置分类外的所有框架均可删除
    - 预置分类包括: Metaphor Analysis, Discourse Analysis, Grammar Analysis, Error Analysis
  - 修复新框架分类的上边框颜色全是黑色的问题
    - 预置分类使用固定颜色，自定义分类使用哈希算法生成舒适色系颜色 (120-220 区间)
  - 修复框架重置功能失败的问题
    - 开发模式下默认框架目录配置错误导致从同一目录复制
    - 修复为从 saves/frameworks 复制默认框架
    - 添加安全检查防止源目录和目标目录相同

### v3.8.76 (2026-01-XX)
- **优化**: 提高所有模块D3可视化PNG导出图片清晰度
  - 将所有可视化模块的PNG导出scale从2提高到3
  - 包括词频统计、N-gram分析、关键词提取、主题建模、语义域分析、共现关系、Word Sketch、文献可视化、标注历史等所有模块
  - Plotly图表和html2canvas导出的PNG图片清晰度均提升50%
  - 框架树导出已使用3x分辨率，保持不变

### v3.8.75 (2026-01-XX)
- **移除**: 取消文本分块处理逻辑
  - 移除 SpaCy 和 USAS 服务中的文本分块处理功能
  - 所有文本现在统一使用普通处理方式，避免分块处理导致的卡住问题
  - 更新相关文档说明

### v3.8.74 (2026-01-10)
- **修复**: BERTopic 层次结构图只显示一层的问题
  - 根因1：`max_df=1`（整数）被误解为"只保留出现在 1 个文档中的词"，导致词汇表过小，主题间余弦相似度为 0
  - 解决1：将 `max_df=1`（整数）自动转换为 `max_df=1.0`（浮点数），表示"保留出现在最多 100% 文档中的词"
  - 根因2：未调用 `hierarchical_topics()` 计算层次结构就直接生成可视化
  - 解决2：先调用 `topic_model.hierarchical_topics(documents)` 计算，再传给 `visualize_hierarchy(hierarchical_topics=...)`
  - 结果缓存中添加 `_documents` 字段，确保可视化时有可用数据
  - 参考官方文档：https://maartengr.github.io/BERTopic/getting_started/visualization/visualize_hierarchy.html
  - 现在能正确显示完整的多层级层次结构（所有合并步骤）

### v3.8.73 (2026-01-10)
- **新功能**: 文本编辑正则表达式实时验证
  - 勾选"使用正则表达式"后，查找框会实时验证正则语法
  - 正确时显示绿色打勾图标，错误时显示红色错误图标并提示错误信息
  - 单文本编辑和批量编辑均支持此功能
  - 参考共现关系 CQL 编辑器的验证方式实现

### v3.8.72 (2026-01-10)
- **修复**: 修复大文本上传后没有进度条和标注的问题
  - 根因：`spacy_service.py` 缺少 `time`、`json`、`traceback` 模块的顶层导入
  - 解决：将这些模块导入移到文件顶部，确保在所有函数中都可用
- **修复**: 前端处理后端返回的 `task_id` 字段名不匹配问题（snake_case vs camelCase）
  - 前端现在同时支持 `taskId` 和 `task_id` 两种命名方式
- **修复**: 批量编辑对话框文本预览无内容
  - 修复了错误的 API 调用方法名（`getTextContent` → `getText`）
- **优化**: 增强日志输出，便于追踪上传和标注流程

---

## License

**Meta-Lingo 软件使用许可协议（非商业）**

Meta-Lingo 为著作权人 Tommy Leo 独立开发完成的语料库研究软件，受《中华人民共和国著作权法》及相关法律法规保护。

本软件仅授权用于个人学习、学术研究以及与语料库分析、语言研究相关的非商业目的。未经著作权人书面许可，不得用于任何商业目的，包括但不限于收费服务、培训课程、商业产品集成等。

详细许可协议请查看：
- [中文版许可证](LICENSE_CN.txt)
- [English Version](LICENSE_EN.txt)

在应用内，您可以通过 **设置 → 软件许可证** 查看完整的许可协议内容。

---

Copyright © 2026 Tommy Leo. All rights reserved.
